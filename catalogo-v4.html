<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="images/Ubits-logo-dark.svg">
    <title>UBITS Playground - Catálogo v4</title>
    
    <!-- Estilos locales -->
    <link rel="stylesheet" href="ubits-colors.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="fontawesome-icons.css">
    <link rel="stylesheet" href="ubits-typography.css">
    <link rel="stylesheet" href="components/sub-nav.css">
    <link rel="stylesheet" href="components-sidebar.css">
    <link rel="stylesheet" href="components/tab-bar.css">
    <link rel="stylesheet" href="components/floating-menu.css">
    <link rel="stylesheet" href="components/profile-menu.css">
    <link rel="stylesheet" href="components/input.css">
    <link rel="stylesheet" href="components/button.css">
    <link rel="stylesheet" href="components/carousel-contents.css">
    <link rel="stylesheet" href="components/status-tag.css">
    <link rel="stylesheet" href="components/ia-button.css">
    <link rel="stylesheet" href="components/copilot-chat.css">
    <link rel="stylesheet" href="profile.css">
    <style>
        /* Estilos específicos para content-sections */
        .content-sections {
            display: flex;
            flex-direction: column;
            gap: 24px;
            flex: 1;
            min-width: 0;
            width: 100%;
            overflow: visible;
            max-height: none;
            padding-bottom: 60px;
        }

        /* Hero de búsqueda minimalista */
        .catalog-hero {
            background: transparent;
            padding: 0;
            margin-bottom: 0;
            text-align: center;
        }

        .catalog-hero h1 {
            color: var(--ubits-fg-1-high);
            margin-bottom: 16px;
        }

        .catalog-search-wrapper {
            display: flex;
            gap: 8px;
            align-items: flex-start;
            margin-bottom: 12px;
            justify-content: center;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .catalog-search-container {
            flex: 1;
            max-width: 600px;
            position: relative;
        }
        
        /* Botones dentro del input de búsqueda */
        .catalog-search-input-buttons {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 10;
        }
        
        /* Ajustar padding del input para los botones */
        #catalog-search-container input.ubits-input {
            padding-right: 150px !important; /* Espacio para 2 botones sm + gaps */
        }
        
        /* Ocultar el icono X del search ya que tenemos botones personalizados */
        #catalog-search-container i[class*="fa-times"] {
            display: none !important;
        }
        
        /* En mobile: ajustar placeholder para que no se corte */
        @media (max-width: 768px) {
            /* Reducir padding del input en mobile para que quepa más texto */
            #catalog-search-container input.ubits-input {
                padding-right: 110px !important; /* Espacio reducido para mobile */
            }
            
            /* Asegurar que el placeholder se muestre correctamente */
            #catalog-search-container input.ubits-input::placeholder {
                text-overflow: ellipsis;
                overflow: hidden;
                white-space: nowrap;
            }
        }
        
        /* Contenedor de sugerencias de búsqueda - KISS: simple y directo */
        #catalog-search-container {
            position: relative;
        }
        
        .search-suggestions-container {
            position: absolute;
            top: calc(100% + 8px);
            left: 0;
            right: 0;
            width: 100%;
            background: var(--ubits-bg-1);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            border: 1px solid var(--ubits-border-1);
            box-sizing: border-box;
        }
        
        .search-suggestions-container.visible {
            display: block;
        }
        
        .search-suggestion-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            border-bottom: 1px solid var(--ubits-border-1);
            color: var(--ubits-fg-1-high);
        }
        
        .search-suggestion-item:last-child {
            border-bottom: none;
        }
        
        .search-suggestion-item:hover {
            background: var(--ubits-bg-2);
        }
        
        .search-suggestion-item .suggestion-text {
            color: var(--ubits-fg-1-high);
            font-size: 14px;
            line-height: 1.5;
            text-align: left;
        }
        
        .search-suggestion-item {
            text-align: left;
        }

        .catalog-filters-btn {
            flex-shrink: 0;
        }

        .catalog-chips-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-top: 8px;
        }

        .catalog-chips-label {
            color: var(--ubits-fg-1-medium);
            white-space: nowrap;
        }

        .catalog-chips {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            overflow-y: hidden;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            flex-wrap: nowrap;
        }

        /* Ocultar scrollbar pero mantener funcionalidad de scroll */
        .catalog-chips {
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE y Edge */
        }

        .catalog-chips::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }

        .catalog-chip {
            background: var(--ubits-bg-1);
            border: 1px solid transparent;
            border-radius: 20px;
            padding: 4px 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--ubits-fg-1-medium);
            white-space: nowrap;
            flex-shrink: 0;
        }

        .catalog-chip:hover {
            background: var(--ubits-bg-gray-subtle-hover);
            color: var(--ubits-fg-1-high);
        }

        /* Wrapper de sección de academias */
        .academias-section-wrapper {
            display: flex;
            flex-direction: column;
        }

        /* Título de sección de academias */
        .academias-section-title {
            color: var(--ubits-fg-1-high);
            margin-bottom: 12px;
        }

        /* Sección de tipos de contenido */
        .tipos-contenido-section-wrapper {
            display: flex;
            flex-direction: column;
            margin-top: 24px;
            overflow: visible;
        }

        .tipos-contenido-section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .tipos-contenido-section-title {
            color: var(--ubits-fg-1-high);
            margin: 0;
        }

        .tipos-contenido-controls {
            display: flex;
            gap: 8px;
        }

        /* Carrusel de tipos de contenido (nuevo - rectangular) */
        .tipos-contenido-carousel-nuevo {
            display: flex;
            flex-direction: row;
            gap: 24px;
            overflow-x: auto;
            overflow-y: visible;
            scroll-behavior: smooth;
            padding: 0;
            -webkit-overflow-scrolling: touch;
        }

        /* Ocultar scrollbar pero mantener funcionalidad de scroll */
        .tipos-contenido-carousel {
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE y Edge */
        }

        .tipos-contenido-carousel::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }

        /* Card de tipo de contenido */
        .tipo-contenido-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0;
            cursor: pointer;
            transition: transform 0.2s ease, border-color 0.2s ease;
            overflow: visible;
            padding: 0;
            margin: 0;
            border: 1px solid transparent;
            flex: 0 0 calc((100% - (7 * 24px)) / 8);
            width: calc((100% - (7 * 24px)) / 8);
            max-width: calc((100% - (7 * 24px)) / 8);
            min-width: calc((100% - (7 * 24px)) / 8);
            box-sizing: border-box;
            flex-shrink: 0;
            position: relative;
            border-radius: 50%;
        }
        
        .tipo-contenido-card:hover {
            border-color: var(--ubits-border-1);
        }
        
        /* Tooltip para cards de aliados */
        .tipo-contenido-card-tooltip {
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background: var(--ubits-fg-1-high);
            color: var(--ubits-logo-inverted);
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            z-index: 10000;
            font-family: 'Noto Sans', sans-serif;
            font-weight: 400;
            visibility: hidden;
        }
        
        .tipo-contenido-card:hover .tipo-contenido-card-tooltip {
            opacity: 1;
            visibility: visible;
        }
        
        .tipo-contenido-card-tooltip.tooltip-right {
            left: auto;
            right: 0;
            transform: none;
        }
        
        .tipo-contenido-card-tooltip.tooltip-left {
            left: 0;
            right: auto;
            transform: none;
        }
        
        .tipo-contenido-card-tooltip.tooltip-bottom {
            bottom: auto;
            top: calc(100% + 8px);
        }
        
        .tipo-contenido-card-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 5px solid var(--ubits-fg-1-high);
        }
        
        .tipo-contenido-card-tooltip.tooltip-bottom::after {
            top: auto;
            bottom: 100%;
            border-top: none;
            border-bottom: 5px solid var(--ubits-fg-1-high);
        }
        
        .tipo-contenido-card-tooltip.tooltip-right::after {
            left: auto;
            right: 14px;
            transform: none;
        }
        
        .tipo-contenido-card-tooltip.tooltip-left::after {
            left: 14px;
            right: auto;
            transform: none;
        }
        


        .tipo-contenido-image {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 50%;
            background: var(--ubits-bg-1);
            border: none;
            transition: transform 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            overflow: hidden;
            padding: 0;
        }

        .tipo-contenido-image img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 50%;
            transition: transform 0.2s ease;
        }

        .tipo-contenido-card:hover .tipo-contenido-image img {
            transform: scale(1.1);
        }

        /* Carrusel de tipos de contenido (nuevo - rectangular) */
        .tipos-contenido-carousel-nuevo {
            display: flex;
            flex-direction: row;
            gap: 24px;
            overflow-x: auto;
            overflow-y: hidden;
            scroll-behavior: smooth;
            padding: 0;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
            min-height: 120px;
        }

        .tipos-contenido-carousel-nuevo::-webkit-scrollbar {
            display: none;
        }

        .tipo-contenido-card-nuevo {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 16px;
            background: var(--ubits-bg-1);
            border: 1px solid transparent;
            border-radius: 8px;
            flex: 0 0 calc((100% - (7 * 24px)) / 8);
            width: calc((100% - (7 * 24px)) / 8);
            max-width: calc((100% - (7 * 24px)) / 8);
            transition: all 0.2s ease;
            min-height: 100px;
            box-sizing: border-box;
        }

        .tipo-contenido-card-nuevo:hover {
            border-color: var(--ubits-border-1);
        }

        .tipo-contenido-icon-nuevo {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--ubits-fg-1-medium);
            transition: color 0.2s ease;
        }

        .tipo-contenido-card-nuevo:hover .tipo-contenido-icon-nuevo {
            color: var(--ubits-fg-1-high);
        }

        .tipo-contenido-icon-nuevo i {
            font-size: 32px;
        }

        .tipo-contenido-name-nuevo {
            text-align: center;
            color: var(--ubits-fg-1-medium);
            transition: color 0.2s ease;
        }

        .tipo-contenido-card-nuevo:hover .tipo-contenido-name-nuevo {
            color: var(--ubits-fg-1-high);
        }

        /* Grid de academias - 5 columnas ocupando todo el ancho */
        .academias-grid-spotify {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        /* Cards de academia - con imagen de fondo y texto blanco */
        .academia-card-spotify {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border-radius: 12px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            color: var(--ubits-logo-inverted);
            position: relative;
            overflow: hidden;
            aspect-ratio: 1 / 1;
        }

        .academia-card-spotify::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.6) 0%, rgba(0, 0, 0, 0.4) 100%);
            border-radius: 12px;
            z-index: 0;
        }

        .academia-card-spotify:hover::before {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0.5) 100%);
        }

        .academia-card-spotify.expanded {
            border-color: var(--ubits-accent-brand);
            position: relative;
        }
        
        .academia-card-spotify.expanded::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--ubits-accent-brand);
            border-radius: 0 0 12px 12px;
            z-index: 10;
        }

        .academia-card-spotify-content {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .academia-card-spotify-content p {
            margin: 0;
        }

        .academia-card-spotify-title {
            color: var(--ubits-logo-inverted);
            margin-top: 0;
            margin-bottom: 0;
            line-height: 1.3;
            position: relative;
            z-index: 1;
        }

        .academia-card-spotify-meta {
            color: var(--ubits-logo-inverted);
            opacity: 0.95;
            line-height: 1.4;
            margin-top: 0;
            position: relative;
            z-index: 1;
        }

        /* Variante para Academia de Habilidades Blandas - imagen arriba, fondo blanco */
        .academia-card-spotify.variant-image-top {
            background: var(--ubits-bg-1);
            background-image: none;
            padding: 0;
            aspect-ratio: auto;
            overflow: hidden;
            border-radius: 12px;
            border: 1px solid transparent;
        }

        .academia-card-spotify.variant-image-top:hover {
            border-color: var(--ubits-border-1);
        }

        .academia-card-spotify.variant-image-top::before {
            display: none;
        }

        .academia-card-spotify.variant-image-top .academia-card-spotify-image {
            width: 100%;
            aspect-ratio: 16 / 9;
            object-fit: cover;
            display: block;
            border-radius: 12px 12px 0 0;
        }

        .academia-card-spotify.variant-image-top .academia-card-spotify-content {
            padding: 16px;
            background: var(--ubits-bg-1);
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .academia-card-spotify.variant-image-top .academia-card-spotify-title {
            color: var(--ubits-fg-1-high);
        }

        .academia-card-spotify.variant-image-top .academia-card-spotify-meta {
            color: var(--ubits-fg-1-medium);
            opacity: 1;
        }

        .academia-card-spotify.variant-image-top.expanded {
            border: 1px solid var(--ubits-accent-brand) !important;
        }

        .academia-card-spotify.variant-image-top.expanded::after {
            display: none;
        }

        /* Contenedor de competencias expandidas */
        .academia-competencias-container {
            display: none;
            margin-top: 24px;
            margin-bottom: 32px;
        }

        .academia-competencias-container.is-visible {
            display: block;
        }

        /* Grid de competencias estilo v1 - cards horizontales */
        .competencias-grid-v1 {
            display: flex;
            gap: 16px;
            align-items: flex-start;
            overflow: visible;
        }

        .competencias-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        /* Wrapper para competencia y habilidades */
        .competencia-card-v1-wrapper {
            display: flex;
            flex-direction: column;
        }

        /* Cards de competencia estilo v1 - horizontales compactas */
        .competencia-card-v1 {
            background: var(--ubits-bg-1);
            border: 1px solid transparent;
            border-radius: 6px;
            overflow: visible;
            cursor: default;
            display: flex;
            flex-direction: row;
            align-items: stretch;
            gap: 0;
            height: 48px;
            position: relative;
            transition: border-color 0.2s ease;
        }
        
        .competencia-card-v1:hover {
            border-color: var(--ubits-border-1);
        }
        
        .competencia-card-v1-actions {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 0 8px;
            flex-shrink: 0;
        }
        
        .competencia-card-v1-chevron {
            transition: transform 0.2s ease;
        }
        
        .competencia-card-v1.expanded .competencia-card-v1-chevron {
            transform: rotate(180deg);
        }


        .competencia-card-v1-image {
            width: 48px;
            height: 48px;
            object-fit: cover;
            background: var(--ubits-bg-2);
            flex-shrink: 0;
            border-radius: 6px 0 0 6px;
        }

        .competencia-card-v1-content {
            padding: 6px 8px;
            display: flex;
            flex-direction: column;
            gap: 2px;
            flex: 1;
            min-width: 0;
            justify-content: center;
            overflow: visible;
        }

        .competencia-card-v1-title-wrapper {
            position: relative;
            width: 100%;
            min-width: 0;
            overflow: visible;
        }

        .competencia-card-v1-title {
            color: var(--ubits-fg-1-high);
            margin-bottom: 0;
            line-height: 1.5;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            max-width: 100%;
        }
        
        .competencia-card-v1-title-text {
            display: inline-block;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 100%;
            color: inherit;
        }
        
        /* Ajuste para status-tag dentro del título */
        .competencia-card-v1-title .ubits-status-tag {
            margin-left: 6px;
            flex-shrink: 0;
            }
            
        .competencia-card-v1-count {
            color: var(--ubits-fg-1-medium);
            line-height: 1.2;
            margin-top: 0;
        }

        /* Wrapper para competencia y habilidades */
        .competencia-card-v1-wrapper {
            display: flex;
                flex-direction: column;
        }

        /* Contenedor de habilidades (acordeón) */
        .competencia-habilidades-container {
            display: none;
            margin-top: 8px;
            padding: 0;
            background: var(--ubits-bg-2);
            border-radius: 6px;
            overflow: hidden;
        }

        .competencia-habilidades-container.is-visible {
            display: block;
        }

        .competencias-habilidades-grid {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .habilidad-chip {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 8px;
            background: var(--ubits-bg-1);
            border: 1px solid transparent;
            border-radius: 20px;
            color: var(--ubits-fg-1-medium);
            white-space: nowrap;
            flex-shrink: 0;
        }

        .habilidad-chip:hover {
            background: var(--ubits-bg-gray-subtle-hover);
            color: var(--ubits-fg-1-high);
        }

        .habilidad-chip i {
            color: var(--ubits-fg-1-medium);
            font-size: 14px;
            transition: color 0.2s ease;
        }

        .habilidad-chip:hover i {
            color: var(--ubits-fg-1-high);
            }
            
        /* Tooltips para botones */
        .competencia-card-v1-actions .ubits-button {
            position: relative;
        }
        
        .competencia-card-v1-actions .ubits-button::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background: var(--ubits-fg-1-high);
            color: var(--ubits-logo-inverted);
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            z-index: 1000;
            font-family: 'Noto Sans', sans-serif;
            font-weight: 400;
        }
        
        .competencia-card-v1-actions .ubits-button.tooltip-right::after {
            left: auto;
            right: 0;
            transform: none;
        }
        
        .competencia-card-v1-actions .ubits-button.tooltip-left::after {
            left: 0;
            right: auto;
            transform: none;
        }
        
        .competencia-card-v1-actions .ubits-button.tooltip-bottom::after {
            bottom: auto;
            top: calc(100% + 8px);
        }
        
        .competencia-card-v1-actions .ubits-button::before {
            content: '';
            position: absolute;
            bottom: calc(100% + 3px);
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 5px solid var(--ubits-fg-1-high);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            z-index: 1001;
        }
        
        .competencia-card-v1-actions .ubits-button.tooltip-bottom::before {
            bottom: auto;
            top: calc(100% + 3px);
            border-top: none;
            border-bottom: 5px solid var(--ubits-fg-1-high);
        }
        
        .competencia-card-v1-actions .ubits-button.tooltip-right::before {
            left: auto;
            right: 14px;
            transform: none;
        }
        
        .competencia-card-v1-actions .ubits-button.tooltip-left::before {
            left: 14px;
            right: auto;
            transform: none;
        }
        
        .competencia-card-v1-actions .ubits-button:hover::after,
        .competencia-card-v1-actions .ubits-button:hover::before {
            opacity: 1;
        }


        /* Estado vacío */
        .catalog-empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .catalog-empty-state-icon {
            font-size: 64px;
            color: var(--ubits-fg-1-low);
            margin-bottom: 16px;
        }

        /* Responsive */
        @media (max-width: 1023px) {
            .tipo-contenido-card {
                flex: 0 0 calc((100% - (4 * 24px)) / 5);
                width: calc((100% - (4 * 24px)) / 5);
                max-width: calc((100% - (4 * 24px)) / 5);
                min-width: calc((100% - (4 * 24px)) / 5);
            }
            
            .tipo-contenido-card-nuevo {
                flex: 0 0 calc((100% - (4 * 24px)) / 5);
                width: calc((100% - (4 * 24px)) / 5);
                max-width: calc((100% - (4 * 24px)) / 5);
                min-width: calc((100% - (4 * 24px)) / 5);
            }
            
            .tipo-contenido-card-nuevo {
                flex: 0 0 calc((100% - (4 * 24px)) / 5);
                width: calc((100% - (4 * 24px)) / 5);
                max-width: calc((100% - (4 * 24px)) / 5);
            }

            .academias-grid-spotify {
                grid-template-columns: repeat(3, 1fr);
                gap: 12px;
            }


            .competencia-card-v1-image {
                width: 48px;
                height: 48px;
            }

            .competencia-card-v1 {
                height: 48px;
            }
        }

        @media (max-width: 768px) {
            .tipo-contenido-card {
                flex: 0 0 calc((100% - (2 * 24px)) / 3);
                min-width: calc((100% - (2 * 24px)) / 3);
            }
            
            .tipo-contenido-card-nuevo {
                flex: 0 0 calc((100% - (2 * 24px)) / 3);
                width: calc((100% - (2 * 24px)) / 3);
                max-width: calc((100% - (2 * 24px)) / 3);
            }
            
            .tipo-contenido-card {
                flex: 0 0 calc((100% - (2 * 24px)) / 3);
                width: calc((100% - (2 * 24px)) / 3);
                max-width: calc((100% - (2 * 24px)) / 3);
                min-width: calc((100% - (2 * 24px)) / 3);
            }
            
            .tipo-contenido-card-nuevo {
                flex: 0 0 calc((100% - (2 * 24px)) / 3);
                width: calc((100% - (2 * 24px)) / 3);
                max-width: calc((100% - (2 * 24px)) / 3);
                min-width: calc((100% - (2 * 24px)) / 3);
            }

            .academias-grid-spotify {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
        }

        @media (max-width: 480px) {
            .catalog-hero {
                padding: 0;
            }

            .catalog-hero h1 {
                font-size: 24px;
            }

            .catalog-search-wrapper {
                flex-direction: column;
            }

            .catalog-chips-wrapper {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .catalog-chips {
                width: 100%;
                overflow-x: auto;
                padding-bottom: 4px;
            }

            .competencias-grid-v1 {
                flex-direction: column;
            }
            
            .competencias-column {
                width: 100%;
            }

            .competencia-card-v1 {
                height: 48px;
            }

            .competencia-card-v1-image {
                width: 48px;
                height: 48px;
            }
        }
    </style>
</head>
<body data-theme="light">
    <div class="dashboard-container">
        <div class="tooltip" id="tooltip"></div>
        
        <!-- Sidebar Container -->
        <div id="sidebar-container"></div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Navigation -->
            <div id="top-nav-container"></div>
            <!-- Content Area -->
            <div class="content-area">
                <!-- Content wrapper con secciones de widgets -->
                <div class="content-sections">
                    <!-- Hero de búsqueda -->
                    <div class="catalog-hero">
                        <h1 class="ubits-heading-h1">¿Qué quieres aprender hoy?</h1>
                        <div class="catalog-search-wrapper">
                            <div class="catalog-search-container" id="catalog-search-container"></div>
                        </div>
                        <div class="catalog-chips-wrapper">
                            <span class="ubits-body-sm-regular catalog-chips-label">Lo más buscado:</span>
                            <div class="catalog-chips" id="catalog-chips"></div>
                        </div>
                    </div>

                    <!-- Wrapper de sección de academias -->
                    <div class="academias-section-wrapper">
                        <!-- Título de sección -->
                        <h2 class="ubits-heading-h2 academias-section-title">Explora por academias</h2>

                        <!-- Contenedor de resultados -->
                        <div id="catalog-results"></div>
                        </div>

                    <!-- Wrapper de sección de aliados destacados - Usando componente oficial -->
                    <div id="aliados-container"></div>
                    
                    <!-- Wrapper de sección de tipos de contenido (nuevo) -->
                    <div class="tipos-contenido-section-wrapper">
                        <!-- Header con título y controles -->
                        <div class="tipos-contenido-section-header">
                            <h2 class="ubits-heading-h2 tipos-contenido-section-title">Explora por tipo de contenido</h2>
                            <div class="tipos-contenido-controls">
                                <button class="ubits-button ubits-button--secondary ubits-button--sm ubits-button--icon-only" id="tipos-contenido-nuevo-prev">
                                    <i class="far fa-chevron-left"></i>
                                </button>
                                <button class="ubits-button ubits-button--secondary ubits-button--sm ubits-button--icon-only" id="tipos-contenido-nuevo-next">
                                    <i class="far fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Carrusel de tipos de contenido (nuevo) -->
                        <div class="tipos-contenido-carousel-nuevo" id="tipos-contenido-carousel-nuevo"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Tab Bar Container -->
    <div id="tab-bar-container"></div>

    <!-- Floating Menu Container -->
    <div id="floating-menu-container"></div>
    
    <!-- Profile Menu Container -->
    <div id="profile-menu-container"></div>


    <script src="components/sidebar.js"></script>
    <script src="components/sub-nav.js"></script>
    <script src="components/tab-bar.js"></script>
    <script src="components/floating-menu.js"></script>
    <script src="components/profile-menu.js"></script>
    <script src="components/input.js"></script>
    <script src="components/carousel-contents.js"></script>
    <script src="components/copilot-chat.js"></script>
    <script src="script.js"></script>
    <script>
        // Competencias asignadas al usuario
        const competenciasAsignadas = ['Liderazgo', 'Comunicación', 'Inglés'];

        // Datos del CSV parseados
        const catalogData = {
            academias: [
                {
                    nombre: 'Academia de Habilidades Blandas',
                    competencias: [
                        { nombre: 'Accountability', habilidades: ['Autogestión', 'Proactividad', 'Integridad'] },
                        { nombre: 'Inteligencia emocional', habilidades: ['Empatía', 'Autoconocimiento', 'Autorregulación', 'Autocompasión', 'Resiliencia'] },
                        { nombre: 'Trabajo en equipo', habilidades: ['Trabajo colaborativo', 'Gestión del conflicto', 'Relacionamiento'] },
                        { nombre: 'Resolución de problemas', habilidades: ['Análisis de escenarios', 'Toma de decisiones', 'Pensamiento crítico'] },
                        { nombre: 'Comunicación', habilidades: ['Asertividad', 'Comunicación efectiva', 'Marca personal', 'Redacción y ortografía', 'Protocolo y etiqueta empresarial', 'Hablar en público', 'Gestión de stakeholders'] },
                        { nombre: 'Productividad', habilidades: ['Gestión del tiempo', 'Planificación', 'Organización'] },
                        { nombre: 'Gestión del cambio', habilidades: ['Orientación a la mejora continua', 'Pensamiento sistémico', 'Adaptabilidad', 'Aprendizaje continuo'] },
                        { nombre: 'Negociación', habilidades: ['Persuasión', 'Generación de acuerdos'] },
                        { nombre: 'Wellness', habilidades: ['Salud mental y emocional', 'Salud física', 'Balance de vida', 'Alimentación saludable', 'Salud financiera'] },
                        { nombre: 'Liderazgo', habilidades: ['Empoderamiento', 'Motivación', 'Pensamiento estratégico', 'Coaching de equipos'] },
                        { nombre: 'Innovación', habilidades: ['Creatividad', 'Pensamiento disruptivo', 'Ideación', 'Pensamiento exponencial'] }
                    ]
                },
                {
                    nombre: 'Academia de Inglés',
                    competencias: [
                        { nombre: 'Inglés', habilidades: ['Grammar', 'Listening', 'Reading', 'Speaking', 'Writing', 'Vocabulary'] }
                    ]
                },
                {
                    nombre: 'Academia de Negocios',
                    competencias: [
                        { nombre: 'Experiencia del cliente', habilidades: ['Servicio al cliente', 'Manejo de objeciones', 'Customer Relationship Management (CRM)', 'Diseño de la experiencia de cliente (CX)'] },
                        { nombre: 'Marketing', habilidades: ['Branding', 'Storytelling', 'Social media'] },
                        { nombre: 'Ventas', habilidades: ['Prospección', 'Gestión de ciclo de ventas', 'Cierre de ventas', 'Venta consultiva', 'Gestión del equipo comercial'] },
                        { nombre: 'Agilidad', habilidades: ['Agilidad de negocios', 'Metodologías ágiles'] },
                        { nombre: 'People management', habilidades: ['Cultura organizacional', 'Adquisición del talento', 'Experiencia del empleado (EX)', 'Relaciones laborales', 'Analítica de personas', 'Diversidad, equidad e inclusión', 'Gestión del desempeño', 'Desarrollo del talento', 'Teletrabajo'] },
                        { nombre: 'Gestión de proyectos', habilidades: ['Planeación de proyectos', 'Control de proyectos'] },
                        { nombre: 'Gestión de procesos y operaciones', habilidades: ['Gestión de la cadena de suministro', 'Gestión de procesos', 'e-Operations', 'Retail', 'Hospitality', 'Automatización de procesos'] },
                        { nombre: 'Gestión financiera', habilidades: ['Planeación financiera', 'Análisis de estados financieros', 'Gestión contable', 'Control financiero', 'Financial services'] },
                        { nombre: 'Administración de negocios', habilidades: ['Estrategia', 'Control de gestión', 'Análisis económico', 'Sostenibilidad y RSE'] },
                        { nombre: 'Emprendimiento', habilidades: ['Propuesta de valor', 'Modelos de negocio', 'Intraemprendimiento'] }
                    ]
                },
                {
                    nombre: 'Academia de Compliance',
                    competencias: [
                        { nombre: 'Cumplimiento (Compliance)', habilidades: ['Cumplimiento en Data & IT', 'Cumplimiento financiero', 'Gobierno corporativo', 'Sistemas de gestión HSEQ +RL', 'Cumplimiento operativo y de calidad', 'Legislación laboral'] },
                        { nombre: 'Gestión del riesgo', habilidades: ['Riesgo operativo', 'Continuidad del negocio'] }
                    ]
                },
                {
                    nombre: 'Academia de Tecnología',
                    competencias: [
                        { nombre: 'Data skills', habilidades: ['Administración de bases de datos', 'Análisis de datos', 'Visualización de datos', 'Inteligencia de negocios (BI)', 'Big data', 'Probabilidad y estadística'] },
                        { nombre: 'Product design', habilidades: ['Design thinking', 'Diseño UX', 'Diseño UI', 'Prototipado', 'UX Research'] },
                        { nombre: 'Desarrollo de software', habilidades: ['Software testing', 'DevOps', 'Herramientas de desarrollo de software', 'Herramientas No Code', 'Pensamiento computacional'] },
                        { nombre: 'Lenguajes de Programación', habilidades: ['SQL', 'Java', 'JavaScript', 'PHP', 'Python', 'NoSQL', 'Ruby', 'R', 'C Sharp (C#)'] },
                        { nombre: 'Desarrollo web', habilidades: ['Desarrollo frontend', 'Desarrollo backend', 'Diseño e implementación de APIs'] },
                        { nombre: 'Herramientas tecnológicas', habilidades: ['Aplicaciones Microsoft', 'Aplicaciones Google', 'Herramientas para proyectos', 'Herramientas colaborativas', 'Herramientas de diseño', 'Herramientas de ventas', 'Aplicaciones Amazon', 'Sistema Linux', 'Computadores, dispositivos electrónicos e internet'] },
                        { nombre: 'Digital skills', habilidades: ['Diseño gráfico digital', 'Tendencias digitales', 'Contenido digital', 'Transformación digital'] },
                        { nombre: 'Gestión de recursos tecnológicos', habilidades: ['Arquitectura TI', 'Infraestructura tecnológica', 'Ciberseguridad', 'Derecho digital'] },
                        { nombre: 'e-Commerce', habilidades: ['Gestión de plataformas de e-commerce'] },
                        { nombre: 'Marketing digital', habilidades: ['Product marketing', 'Analítica en marketing', 'Gestión del funnel de conversión', 'Growth marketing', 'Google Analytics', 'Google Ads', 'Inbound marketing'] }
                    ]
                }
            ]
        };

        // Mapeo de nombres de competencias a archivos de imagen
        const competenciaImageMap = {
            'Accountability': 'Accountability.jpg',
            'Inteligencia emocional': 'Inteligencia emocional.jpg',
            'Trabajo en equipo': 'Trabajo en equipo.jpg',
            'Resolución de problemas': 'Resolución de problemas.jpg',
            'Comunicación': 'Comunicación.jpg',
            'Productividad': 'Productividad.jpg',
            'Gestión del cambio': 'Gestión del cambio.jpg',
            'Negociación': 'Negociación.jpg',
            'Wellness': 'Wellness.jpg',
            'Liderazgo': 'Liderazgo.jpg',
            'Inglés': 'Inglés.jpg',
            'Innovación': 'Innovación.jpg',
            'Experiencia del cliente': 'Experiencia del cliente.jpg',
            'Marketing': 'Marketing.jpg',
            'Ventas': 'Ventas.jpg',
            'Agilidad': 'Agilidad.jpg',
            'People management': 'People management.jpg',
            'Gestión de proyectos': 'Gestión de proyectos.jpg',
            'Gestión de procesos y operaciones': 'Gestión de procesos y operaciones.jpg',
            'Gestión financiera': 'Gestión financiera.jpg',
            'Administración de negocios': 'Administración de negocios.jpg',
            'Emprendimiento': 'Emprendimiento.jpg',
            'Gestión del riesgo': 'Gestión del riesgo.jpg',
            'Cumplimiento (Compliance)': 'Cumplimiento (Compliance).jpg',
            'Data skills': 'Data skills.jpg',
            'Product design': 'Product design.jpg',
            'Desarrollo de software': 'Desarrollo de software.jpg',
            'Lenguajes de Programación': 'Lenguajes de Programación.jpg',
            'Desarrollo web': 'Desarrollo web.jpg',
            'Herramientas tecnológicas': 'Herramientas tecnológicas.jpg',
            'Digital skills': 'Digital skills.jpg',
            'Gestión de recursos tecnológicos': 'Gestión de recursos tecnológicos.jpg',
            'e-Commerce': 'e-Commerce.jpg',
            'Marketing digital': 'Marketing digital.jpg'
        };

        // Imágenes placeholder para academias (usando Unsplash)
        const academiaImageMap = {
            'Academia de Habilidades Blandas': 'https://images.unsplash.com/photo-1522202176988-66273c2fd55f?w=400&h=400&fit=crop',
            'Academia de Inglés': 'https://images.unsplash.com/photo-1434030216411-0b793f4b4173?w=400&h=400&fit=crop',
            'Academia de Negocios': 'https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?w=400&h=400&fit=crop',
            'Academia de Compliance': 'https://images.unsplash.com/photo-1450101499163-c8848c66ca85?w=400&h=400&fit=crop',
            'Academia de Tecnología': 'https://images.unsplash.com/photo-1518770660439-4636190af475?w=400&h=400&fit=crop'
        };

        // Iconos para habilidades
        const habilidadIconMap = {
            'Autogestión': 'fa-user-check',
            'Proactividad': 'fa-rocket',
            'Integridad': 'fa-shield-check',
            'Empatía': 'fa-heart',
            'Autoconocimiento': 'fa-brain',
            'Autorregulación': 'fa-balance-scale',
            'Autocompasión': 'fa-hands-helping',
            'Resiliencia': 'fa-dumbbell',
            'Trabajo colaborativo': 'fa-users',
            'Gestión del conflicto': 'fa-handshake',
            'Relacionamiento': 'fa-network-wired',
            'Análisis de escenarios': 'fa-chart-line',
            'Toma de decisiones': 'fa-check-circle',
            'Pensamiento crítico': 'fa-lightbulb',
            'Asertividad': 'fa-comments',
            'Comunicación efectiva': 'fa-bullhorn',
            'Marca personal': 'fa-user-tag',
            'Redacción y ortografía': 'fa-pen',
            'Protocolo y etiqueta empresarial': 'fa-handshake',
            'Hablar en público': 'fa-microphone',
            'Gestión de stakeholders': 'fa-users-cog',
            'Gestión del tiempo': 'fa-clock',
            'Planificación': 'fa-calendar-check',
            'Organización': 'fa-folder-open',
            'Orientación a la mejora continua': 'fa-chart-line',
            'Pensamiento sistémico': 'fa-project-diagram',
            'Adaptabilidad': 'fa-sync',
            'Aprendizaje continuo': 'fa-graduation-cap',
            'Persuasión': 'fa-comments-dollar',
            'Generación de acuerdos': 'fa-handshake',
            'Salud mental y emocional': 'fa-heart',
            'Salud física': 'fa-dumbbell',
            'Balance de vida': 'fa-balance-scale',
            'Alimentación saludable': 'fa-apple-alt',
            'Salud financiera': 'fa-wallet',
            'Empoderamiento': 'fa-crown',
            'Motivación': 'fa-fire',
            'Pensamiento estratégico': 'fa-chess',
            'Coaching de equipos': 'fa-users-cog',
            'Grammar': 'fa-book',
            'Listening': 'fa-headphones',
            'Reading': 'fa-book-open',
            'Speaking': 'fa-microphone',
            'Writing': 'fa-pen-fancy',
            'Vocabulary': 'fa-book-reader',
            'Creatividad': 'fa-palette',
            'Pensamiento disruptivo': 'fa-lightbulb',
            'Ideación': 'fa-lightbulb-on',
            'Pensamiento exponencial': 'fa-chart-line',
            'Servicio al cliente': 'fa-headset',
            'Manejo de objeciones': 'fa-comments',
            'Customer Relationship Management (CRM)': 'fa-address-book',
            'Diseño de la experiencia de cliente (CX)': 'fa-smile',
            'Branding': 'fa-tag',
            'Storytelling': 'fa-book',
            'Social media': 'fa-share-alt',
            'Prospección': 'fa-search',
            'Gestión de ciclo de ventas': 'fa-sync',
            'Cierre de ventas': 'fa-handshake',
            'Venta consultiva': 'fa-comments-dollar',
            'Gestión del equipo comercial': 'fa-users',
            'Agilidad de negocios': 'fa-tachometer-alt',
            'Metodologías ágiles': 'fa-project-diagram',
            'Cultura organizacional': 'fa-building',
            'Adquisición del talento': 'fa-user-plus',
            'Experiencia del empleado (EX)': 'fa-user-check',
            'Relaciones laborales': 'fa-handshake',
            'Analítica de personas': 'fa-chart-bar',
            'Diversidad, equidad e inclusión': 'fa-users',
            'Gestión del desempeño': 'fa-chart-line',
            'Desarrollo del talento': 'fa-user-graduate',
            'Teletrabajo': 'fa-laptop',
            'Planeación de proyectos': 'fa-calendar-alt',
            'Control de proyectos': 'fa-tasks',
            'Gestión de la cadena de suministro': 'fa-truck',
            'Gestión de procesos': 'fa-cogs',
            'e-Operations': 'fa-server',
            'Retail': 'fa-store',
            'Hospitality': 'fa-hotel',
            'Automatización de procesos': 'fa-robot',
            'Planeación financiera': 'fa-chart-pie',
            'Análisis de estados financieros': 'fa-file-invoice-dollar',
            'Gestión contable': 'fa-calculator',
            'Control financiero': 'fa-wallet',
            'Financial services': 'fa-university',
            'Estrategia': 'fa-chess',
            'Control de gestión': 'fa-clipboard-check',
            'Análisis económico': 'fa-chart-line',
            'Sostenibilidad y RSE': 'fa-leaf',
            'Propuesta de valor': 'fa-gem',
            'Modelos de negocio': 'fa-briefcase',
            'Intraemprendimiento': 'fa-rocket',
            'Riesgo operativo': 'fa-exclamation-triangle',
            'Continuidad del negocio': 'fa-shield-alt',
            'Cumplimiento en Data & IT': 'fa-database',
            'Cumplimiento financiero': 'fa-file-invoice',
            'Gobierno corporativo': 'fa-building',
            'Sistemas de gestión HSEQ +RL': 'fa-clipboard-check',
            'Cumplimiento operativo y de calidad': 'fa-check-circle',
            'Legislación laboral': 'fa-gavel',
            'Administración de bases de datos': 'fa-database',
            'Análisis de datos': 'fa-chart-bar',
            'Visualización de datos': 'fa-chart-pie',
            'Inteligencia de negocios (BI)': 'fa-brain',
            'Big data': 'fa-server',
            'Probabilidad y estadística': 'fa-chart-line',
            'Design thinking': 'fa-lightbulb',
            'Diseño UX': 'fa-mouse-pointer',
            'Diseño UI': 'fa-palette',
            'Prototipado': 'fa-drafting-compass',
            'UX Research': 'fa-search',
            'Software testing': 'fa-vial',
            'DevOps': 'fa-code-branch',
            'Herramientas de desarrollo de software': 'fa-tools',
            'Herramientas No Code': 'fa-magic',
            'Pensamiento computacional': 'fa-brain',
            'SQL': 'fa-database',
            'Java': 'fa-coffee',
            'JavaScript': 'fa-code',
            'PHP': 'fa-code',
            'Python': 'fa-code',
            'NoSQL': 'fa-database',
            'Ruby': 'fa-gem',
            'R': 'fa-chart-bar',
            'C Sharp (C#)': 'fa-code',
            'Desarrollo frontend': 'fa-laptop-code',
            'Desarrollo backend': 'fa-server',
            'Diseño e implementación de APIs': 'fa-plug',
            'Aplicaciones Microsoft': 'fa-windows',
            'Aplicaciones Google': 'fa-google',
            'Herramientas para proyectos': 'fa-tasks',
            'Herramientas colaborativas': 'fa-users',
            'Herramientas de diseño': 'fa-palette',
            'Herramientas de ventas': 'fa-handshake',
            'Aplicaciones Amazon': 'fa-amazon',
            'Sistema Linux': 'fa-linux',
            'Computadores, dispositivos electrónicos e internet': 'fa-desktop',
            'Diseño gráfico digital': 'fa-paint-brush',
            'Tendencias digitales': 'fa-trending-up',
            'Contenido digital': 'fa-file-alt',
            'Transformación digital': 'fa-sync',
            'Arquitectura TI': 'fa-network-wired',
            'Infraestructura tecnológica': 'fa-server',
            'Ciberseguridad': 'fa-shield-alt',
            'Derecho digital': 'fa-gavel',
            'Gestión de plataformas de e-commerce': 'fa-shopping-cart',
            'Product marketing': 'fa-bullhorn',
            'Analítica en marketing': 'fa-chart-bar',
            'Gestión del funnel de conversión': 'fa-filter',
            'Growth marketing': 'fa-chart-line',
            'Google Analytics': 'fa-chart-bar',
            'Google Ads': 'fa-ad',
            'Inbound marketing': 'fa-arrow-down'
        };

        // Cargar componentes dinámicamente
        document.addEventListener('DOMContentLoaded', function() {
            loadSidebar('sidebar-container', 'aprendizaje');
            loadSubNav('top-nav-container', 'aprendizaje');
            loadTabBar('tab-bar-container');
            loadFloatingMenu('floating-menu-container');
            loadProfileMenu('profile-menu-container');
            
            // Inicializar el chat copilot
            if (typeof initCopilotChat === 'function') {
                initCopilotChat();
                console.log('✅ Copilot Chat inicializado');
            } else {
                console.error('❌ La función initCopilotChat no está disponible');
            }
            
            // Base de datos de sugerencias
            const searchSuggestions = {
                'ia': [
                    'Inteligencia artificial',
                    'Inteligencia artificial y ética',
                    'Máster de inteligencia artificial para agentes de viajes',
                    'Introduccion a la inteligencia artificial',
                    'Herramientas de inteligencia artificial',
                    'Inteligencia artificial como potenciador de un negocio',
                    'Genera videos con inteligencia artificial',
                    'Inteligencia artificial y su impacto en ventas',
                    'Casos practicos de inteligencia artificial',
                    'Inteligencia artificial generativa'
                ]
            };
            
            // Función para mostrar sugerencias - KISS: simple y directo
            function showSuggestions(query) {
                const suggestionsContainer = document.getElementById('search-suggestions-container');
                if (!suggestionsContainer) {
                    console.error('❌ No se encontró el contenedor de sugerencias');
                    return;
                }
                
                const normalizedQuery = query.toLowerCase().trim();
                console.log('🔍 Buscando sugerencias para:', normalizedQuery);
                
                if (normalizedQuery.length === 0) {
                    suggestionsContainer.classList.remove('visible');
                    return;
                }
                
                // Buscar sugerencias
                let suggestions = [];
                
                // Buscar coincidencias exactas
                for (const [key, values] of Object.entries(searchSuggestions)) {
                    if (normalizedQuery.includes(key) || key.includes(normalizedQuery)) {
                        suggestions = values.slice(0, 8);
                        break;
                    }
                }
                
                // Si no hay coincidencias, buscar en el contenido
                if (suggestions.length === 0) {
                    for (const [key, values] of Object.entries(searchSuggestions)) {
                        const matching = values.filter(s => s.toLowerCase().includes(normalizedQuery));
                        if (matching.length > 0) {
                            suggestions = matching.slice(0, 8);
                            break;
                        }
                    }
                }
                
                if (suggestions.length > 0) {
                    console.log('✅ Encontradas', suggestions.length, 'sugerencias');
                    suggestionsContainer.innerHTML = suggestions.map(suggestion => `
                        <div class="search-suggestion-item">
                            <span class="suggestion-text">${suggestion}</span>
                        </div>
                    `).join('');
                    
                    suggestionsContainer.classList.add('visible');
                    
                    // Listeners para clic en sugerencias
                    suggestionsContainer.querySelectorAll('.search-suggestion-item').forEach(item => {
                        item.addEventListener('click', function() {
                            const searchInput = document.querySelector('#catalog-search-container input');
                            if (searchInput) {
                                searchInput.value = this.querySelector('.suggestion-text').textContent;
                                suggestionsContainer.classList.remove('visible');
                                searchInput.focus();
                                searchInput.dispatchEvent(new Event('input', { bubbles: true }));
                            }
                        });
                    });
                } else {
                    console.log('❌ No se encontraron sugerencias');
                    suggestionsContainer.classList.remove('visible');
                }
            }

            // Crear input de búsqueda
            setTimeout(() => {
                createInput({
                    containerId: 'catalog-search-container',
                    type: 'search',
                    placeholder: 'Buscar un tema, competencia o habilidad...',
                    size: 'lg'
                });

                // Agregar botones dentro del input y listeners - Verificación directa sin delay largo
                const setupButtons = () => {
                    const searchInput = document.querySelector('#catalog-search-container input');
                    const searchContainer = document.getElementById('catalog-search-container');
                    
                    console.log('🔍 Setup sugerencias:', { searchInput: !!searchInput, searchContainer: !!searchContainer });
                    
                    if (!searchInput || !searchContainer) {
                        // Si aún no están listos, reintentar rápidamente
                        setTimeout(setupButtons, 10);
                        return;
                    }
                    
                    // Ocultar el icono X del search (rightIcon) ya que tendremos botones personalizados
                    const clearIcon = searchContainer.querySelector('i[class*="fa-times"]');
                    if (clearIcon) {
                        clearIcon.style.display = 'none';
                    }
                    
                    // En mobile: cambiar placeholder a uno más corto para que no se corte
                    function updatePlaceholderForMobile() {
                        if (window.innerWidth <= 768) {
                            searchInput.placeholder = 'Buscar...';
                        } else {
                            searchInput.placeholder = 'Buscar un tema, competencia o habilidad...';
                        }
                    }
                    
                    // Actualizar placeholder al cargar y al cambiar tamaño de ventana
                    updatePlaceholderForMobile();
                    window.addEventListener('resize', updatePlaceholderForMobile);
                    
                    // Agregar botones dentro del input
                    const inputWrapper = searchInput.parentElement; // El div con position: relative
                    if (inputWrapper) {
                        // Crear contenedor de botones
                        let buttonsContainer = inputWrapper.querySelector('.catalog-search-input-buttons');
                        if (!buttonsContainer) {
                            buttonsContainer = document.createElement('div');
                            buttonsContainer.className = 'catalog-search-input-buttons';
                            
                            // Botón de filtros (terciario, icon-only, sm)
                            const filterButton = document.createElement('button');
                            filterButton.className = 'ubits-button ubits-button--tertiary ubits-button--sm ubits-button--icon-only';
                            filterButton.setAttribute('aria-label', 'Filtros');
                            filterButton.innerHTML = '<i class="far fa-filter"></i>';
                            filterButton.addEventListener('click', function(e) {
                                e.preventDefault();
                                e.stopPropagation();
                                console.log('🔍 Filtros clickeado');
                                // Aquí puedes agregar la lógica de filtros
                            });
                            
                            // Botón de Modo IA (ia-button secundario, sm)
                            const iaButton = document.createElement('button');
                            iaButton.className = 'ubits-ia-button ubits-ia-button--secondary ubits-ia-button--sm';
                            iaButton.innerHTML = '<i class="far fa-sparkles"></i><span>Modo IA</span>';
                            iaButton.addEventListener('click', function(e) {
                                e.preventDefault();
                                e.stopPropagation();
                                console.log('🤖 Modo IA clickeado');
                                // Abrir copilot chat
                                if (typeof openCopilotChat === 'function') {
                                    openCopilotChat();
                                    console.log('✅ Copilot Chat abierto');
                                } else {
                                    console.error('❌ La función openCopilotChat no está disponible');
                                }
                            });
                            
                            buttonsContainer.appendChild(filterButton);
                            buttonsContainer.appendChild(iaButton);
                            inputWrapper.appendChild(buttonsContainer);
                            console.log('✅ Botones agregados dentro del input');
                        }
                        
                        // KISS: Crear contenedor de sugerencias y moverlo al div con position: relative que crea createInput
                        let suggestionsContainer = document.getElementById('search-suggestions-container');
                        if (!suggestionsContainer) {
                            suggestionsContainer = document.createElement('div');
                            suggestionsContainer.id = 'search-suggestions-container';
                            suggestionsContainer.className = 'search-suggestions-container';
                        }
                        
                        // Mover el contenedor de sugerencias al div con position: relative que crea createInput
                        inputWrapper.style.position = 'relative';
                        inputWrapper.style.zIndex = '1000';
                        inputWrapper.appendChild(suggestionsContainer);
                        console.log('✅ Contenedor de sugerencias movido al wrapper del input');
                    } else {
                        // Fallback: usar el contenedor padre
                        searchContainer.style.position = 'relative';
                        searchContainer.style.zIndex = '1000';
                        searchContainer.appendChild(suggestionsContainer);
                    }
                    
                    // Listener simple para input
                    searchInput.addEventListener('input', function(e) {
                        const value = this.value;
                        console.log('📝 Input cambiado:', value);
                        showSuggestions(value);
                        handleSearch(e);
                    });
                    
                    // El botón X ya está oculto, no necesitamos listener para él
                    
                    // Ocultar al hacer clic fuera
                    document.addEventListener('click', function(e) {
                        if (!searchContainer.contains(e.target) && !suggestionsContainer.contains(e.target)) {
                            suggestionsContainer.classList.remove('visible');
                        }
                    });
                };
                
                // Llamar inmediatamente - se reintentará automáticamente si no está listo
                setupButtons();
            }, 300);

            // Renderizar chips de búsquedas frecuentes
            renderChips();

            // Renderizar catálogo inicial
            renderCatalog(catalogData.academias);

            // Renderizar aliados destacados usando componente oficial
            if (typeof createCarouselContents === 'function') {
                createCarouselContents({
                    containerId: 'aliados-container',
                    type: 'allies',
                    sectionTitle: 'Explora por aliados destacados',
                    slides: [
                        {
                            name: 'UBITS',
                            logo: 'images/Favicons/UBITS.jpg'
                        },
                        {
                            name: 'Microsoft',
                            logo: 'images/Favicons/Microsoft.jpg'
                        },
                        {
                            name: 'TED',
                            logo: 'images/Favicons/TED.jpg'
                        },
                        {
                            name: 'Harvard Business Publishing',
                            logo: 'images/Favicons/Harvard-Business-Publishing.jpg'
                        },
                        {
                            name: 'All Ears English',
                            logo: 'images/Favicons/All Ears English.jpg'
                        },
                        {
                            name: 'IE University Publishing',
                            logo: 'images/Favicons/IE-University-Publishing.jpg'
                        },
                        {
                            name: 'WOBI',
                            logo: 'images/Favicons/WOBI.jpg'
                        },
                        {
                            name: 'Hubspot',
                            logo: 'images/Favicons/Hubspot.jpg'
                        },
                        {
                            name: 'AWS',
                            logo: 'images/Favicons/AWS.jpg'
                        },
                        {
                            name: 'Código Facilito',
                            logo: 'images/Favicons/Código-Facilito.jpg'
                        },
                        {
                            name: 'Universidad de Los Andes',
                            logo: 'images/Favicons/Universidad-de-Los Andes.jpg'
                        },
                        {
                            name: 'Welu',
                            logo: 'images/Favicons/Welu.jpg'
                        }
                    ],
                    onButtonClick: function(ally, index) {
                        console.log('Ally clicked:', ally.name, 'Index:', index);
                        // Aquí puedes agregar la lógica de filtrado por aliado
                    }
                });
            }
            
            // Renderizar tipos de contenido (nuevo carrusel) - con delay para asegurar que el DOM esté listo
            setTimeout(() => {
                renderTiposContenidoNuevo();
            }, 100);

            // Listener de resize para actualizar el catálogo dinámicamente
            let resizeTimeout;
            let lastWindowWidth = window.innerWidth;
            let isRendering = false; // Flag para prevenir re-renders infinitos
            window.addEventListener('resize', function() {
                // Prevenir re-render si ya se está renderizando
                if (isRendering) return;
                
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(function() {
                    const currentWidth = window.innerWidth;
                    // Determinar número de columnas según el ancho
                    let numColumns = 3;
                    if (currentWidth <= 768) {
                        numColumns = 1;
                    } else if (currentWidth <= 1023) {
                        numColumns = 2;
                    }
                    
                    // Determinar número de columnas del ancho anterior
                    let lastNumColumns = 3;
                    if (lastWindowWidth <= 768) {
                        lastNumColumns = 1;
                    } else if (lastWindowWidth <= 1023) {
                        lastNumColumns = 2;
                    }
                    
                    // Solo re-renderizar si cambió el número de columnas
                    if (numColumns !== lastNumColumns) {
                        isRendering = true; // Marcar que se está renderizando
                        
                        // Guardar estado actual (academias y competencias expandidas)
                        const expandedAcademias = [];
                        document.querySelectorAll('.academia-card-spotify.expanded').forEach(card => {
                            expandedAcademias.push(card.dataset.academia);
                        });
                        
                        const expandedCompetencias = [];
                        document.querySelectorAll('.competencia-card-v1.expanded').forEach(card => {
                            expandedCompetencias.push({
                                competencia: card.dataset.competencia,
                                academia: card.dataset.academia
                            });
                        });
                        
                        // Guardar término de búsqueda
                        const searchInput = document.querySelector('#catalog-search-container input');
                        const searchTerm = searchInput ? searchInput.value : '';
                        
                        // Re-renderizar
                        if (searchTerm.trim() === '') {
                            renderCatalog(catalogData.academias);
                        } else {
                            handleSearch({ target: { value: searchTerm } });
                        }
                        
                        // Restaurar estado
                        setTimeout(() => {
                            expandedAcademias.forEach(academiaNombre => {
                                const card = document.querySelector(`.academia-card-spotify[data-academia="${academiaNombre}"]`);
                                const container = document.querySelector(`.academia-competencias-container[data-academia="${academiaNombre}"]`);
                                if (card && container) {
                                    card.classList.add('expanded');
                                    container.classList.add('is-visible');
                                }
                            });
                            
                            expandedCompetencias.forEach(({ competencia, academia }) => {
                                const card = document.querySelector(`.competencia-card-v1[data-competencia="${competencia}"][data-academia="${academia}"]`);
                                const container = document.querySelector(`.competencia-habilidades-container[data-competencia="${competencia}"][data-academia="${academia}"]`);
                                if (card && container) {
                                    card.classList.add('expanded');
                                    container.classList.add('is-visible');
                                    // Restaurar rotación del chevron
                                    const chevronBtn = card.querySelector('.competencia-card-v1-chevron-btn');
                                    if (chevronBtn) {
                                        const chevronIcon = chevronBtn.querySelector('.competencia-card-v1-chevron');
                                        if (chevronIcon) {
                                            chevronIcon.style.transform = 'rotate(180deg)';
                                        }
                                    }
                                }
                            });
                            
                            isRendering = false; // Marcar que terminó el renderizado
                        }, 50);
                        
                        lastWindowWidth = currentWidth;
                    }
                }, 150);
            });

            // Hacer funciones accesibles globalmente
            window.handleChipClick = handleChipClick;

            // Activar el tab "Catálogo"
            setTimeout(() => {
                document.querySelectorAll('.nav-tab, .hamburger-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                const catalogTab = document.querySelector('.nav-tab[data-tab="catalog"]');
                if (catalogTab) catalogTab.classList.add('active');
                
                const catalogHamburger = document.querySelector('.hamburger-item[data-tab="catalog"]');
                if (catalogHamburger) catalogHamburger.classList.add('active');
                
                const aprendizajeButton = document.querySelector('.nav-button[data-section="aprendizaje"]');
                if (aprendizajeButton) {
                    document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active'));
                    aprendizajeButton.classList.add('active');
                }
                
                const modulosTabBarItem = document.querySelector('.tab-bar-item[data-tab="modulos"]');
                if (modulosTabBarItem) {
                    document.querySelectorAll('.tab-bar-item').forEach(item => item.classList.remove('active'));
                    modulosTabBarItem.classList.add('active');
                }
                
                if (typeof setActiveAccordionLink === 'function') {
                    setActiveAccordionLink('catalogo');
                }
            }, 200);
        });

        // Función para renderizar chips de búsquedas frecuentes
        function renderChips() {
            const busquedasFrecuentes = [
                'Liderazgo',
                'Product Design',
                'Marketing Digital',
                'Desarrollo de Software',
                'Data Skills'
            ];

            const chipsContainer = document.getElementById('catalog-chips');
            chipsContainer.innerHTML = busquedasFrecuentes.map(busqueda => `
                <div class="catalog-chip" onclick="handleChipClick('${busqueda}')">
                    <span class="ubits-body-sm-regular">${busqueda}</span>
                </div>
            `).join('');
        }

        // Función para manejar click en chip
        function handleChipClick(busqueda) {
            const searchInput = document.querySelector('#catalog-search-container input');
            if (searchInput) {
                searchInput.value = busqueda;
                searchInput.dispatchEvent(new Event('input', { bubbles: true }));
            }
        }

        // Función de búsqueda
        function handleSearch(event) {
            const searchTerm = event.target.value.toLowerCase().trim();
            const resultsContainer = document.getElementById('catalog-results');
            
            if (searchTerm === '') {
                renderCatalog(catalogData.academias);
                return;
            }

            // Filtrar resultados
            const filteredAcademias = catalogData.academias.map(academia => {
                const competenciasFiltradas = academia.competencias.map(competencia => {
                    const habilidadesFiltradas = competencia.habilidades.filter(habilidad =>
                        habilidad.toLowerCase().includes(searchTerm)
                    );
                    
                    if (habilidadesFiltradas.length > 0 || 
                        competencia.nombre.toLowerCase().includes(searchTerm)) {
                        return {
                            ...competencia,
                            habilidades: habilidadesFiltradas.length > 0 ? habilidadesFiltradas : competencia.habilidades
                        };
                    }
                    return null;
                }).filter(c => c !== null);

                if (competenciasFiltradas.length > 0 || 
                    academia.nombre.toLowerCase().includes(searchTerm)) {
                    return {
                        ...academia,
                        competencias: competenciasFiltradas
                    };
                }
                return null;
            }).filter(a => a !== null);

            if (filteredAcademias.length === 0) {
                resultsContainer.innerHTML = `
                    <div class="catalog-empty-state">
                        <div class="catalog-empty-state-icon">
                            <i class="far fa-search"></i>
                        </div>
                        <h2 class="ubits-heading-h2">No se encontraron resultados</h2>
                        <p class="ubits-body-md-regular">Intenta con otros términos de búsqueda</p>
                    </div>
                `;
            } else {
                renderCatalog(filteredAcademias);
            }
        }

        // Función para renderizar el catálogo
        // Función para renderizar tipos de contenido

        // Función para renderizar el nuevo carrusel de tipos de contenido (rectangular)
        function renderTiposContenidoNuevo() {
            const carouselContainer = document.getElementById('tipos-contenido-carousel-nuevo');
            if (!carouselContainer) {
                console.error('No se encontró el contenedor tipos-contenido-carousel-nuevo');
                return;
            }

            // Tipos de contenido oficiales (de la v2)
            const tiposContenido = [
                'Curso',
                'Short',
                'Charla',
                'Artículo',
                'Podcast',
                'Libro',
                'Ideas de libro',
                'Caso de estudio',
                'Documento técnico',
                'Ejercicios de práctica',
                'Ruta de aprendizaje',
                'Programa'
            ];

            // Mapeo de iconos por tipo de contenido (de la v2)
            const iconosPorTipo = {
                'Curso': 'fa-graduation-cap',
                'Short': 'fa-capsules',
                'Charla': 'fa-comments',
                'Artículo': 'fa-file-lines',
                'Podcast': 'fa-podcast',
                'Libro': 'fa-book',
                'Ideas de libro': 'fa-lightbulb',
                'Caso de estudio': 'fa-briefcase',
                'Documento técnico': 'fa-file-code',
                'Ejercicios de práctica': 'fa-dumbbell',
                'Ruta de aprendizaje': 'fa-route',
                'Programa': 'fa-network-wired'
            };

            const htmlContent = tiposContenido.map(tipo => {
                const icono = iconosPorTipo[tipo] || 'fa-circle';
                
                return `
                    <div class="tipo-contenido-card-nuevo" data-tipo="${tipo}">
                        <div class="tipo-contenido-icon-nuevo">
                            <i class="far ${icono}"></i>
                        </div>
                        <span class="ubits-body-sm-regular tipo-contenido-name-nuevo">${tipo}</span>
                    </div>
                `;
            }).join('');
            
            carouselContainer.innerHTML = htmlContent;

            // Agregar event listeners para los cards
            carouselContainer.querySelectorAll('.tipo-contenido-card-nuevo').forEach(card => {
                card.addEventListener('click', function() {
                    const tipo = this.dataset.tipo;
                    // Aquí puedes agregar la lógica de filtrado por tipo de contenido
                    console.log('Tipo seleccionado:', tipo);
                });
            });

            // Agregar event listeners para los botones de control del carrusel
            const prevButton = document.getElementById('tipos-contenido-nuevo-prev');
            const nextButton = document.getElementById('tipos-contenido-nuevo-next');

            // Función para obtener el número de items a mover según el breakpoint
            function getItemsToMoveNuevo() {
                if (window.innerWidth <= 768) {
                    return 3; // Mobile
                } else if (window.innerWidth <= 1023) {
                    return 5; // Tablet
                }
                return 8; // Desktop
            }

            // Función para obtener el índice del primer item visible
            function getFirstVisibleIndexNuevo() {
                const cards = carouselContainer.querySelectorAll('.tipo-contenido-card-nuevo');
                if (cards.length === 0) return 0;

                const containerRect = carouselContainer.getBoundingClientRect();
                for (let i = 0; i < cards.length; i++) {
                    const cardRect = cards[i].getBoundingClientRect();
                    if (cardRect.left >= containerRect.left) {
                        return i;
                    }
                }
                return 0;
            }

            // Función para actualizar el estado de los botones
            function updateCarouselButtonsNuevo() {
                if (!carouselContainer || !prevButton || !nextButton) return;

                const scrollLeft = carouselContainer.scrollLeft;
                const scrollWidth = carouselContainer.scrollWidth;
                const clientWidth = carouselContainer.clientWidth;
                const isAtStart = scrollLeft <= 0;
                const isAtEnd = scrollLeft + clientWidth >= scrollWidth - 1;

                prevButton.disabled = isAtStart;
                nextButton.disabled = isAtEnd;
            }

            // Scroll al siguiente grupo de items
            function scrollToNextGroupNuevo() {
                const cards = carouselContainer.querySelectorAll('.tipo-contenido-card-nuevo');
                if (cards.length === 0) return;
                
                const itemsToMove = getItemsToMoveNuevo();
                const currentIndex = getFirstVisibleIndexNuevo();
                const nextIndex = Math.min(cards.length - 1, currentIndex + itemsToMove);
                
                if (nextIndex === currentIndex) {
                    setTimeout(updateCarouselButtonsNuevo, 400);
                    return;
                }
                
                const targetCard = cards[nextIndex];
                const targetCardRect = targetCard.getBoundingClientRect();
                const containerRect = carouselContainer.getBoundingClientRect();
                const scrollLeft = carouselContainer.scrollLeft;
                
                carouselContainer.scrollTo({
                    left: scrollLeft + (targetCardRect.left - containerRect.left),
                    behavior: 'smooth'
                });
                
                setTimeout(updateCarouselButtonsNuevo, 400);
            }

            // Scroll al grupo anterior de items
            function scrollToPrevGroupNuevo() {
                const cards = carouselContainer.querySelectorAll('.tipo-contenido-card-nuevo');
                if (cards.length === 0) return;
                
                const itemsToMove = getItemsToMoveNuevo();
                const currentIndex = getFirstVisibleIndexNuevo();
                const prevIndex = Math.max(0, currentIndex - itemsToMove);
                
                if (prevIndex === currentIndex) {
                    setTimeout(updateCarouselButtonsNuevo, 400);
                    return;
                }
                
                const targetCard = cards[prevIndex];
                const targetCardRect = targetCard.getBoundingClientRect();
                const containerRect = carouselContainer.getBoundingClientRect();
                const scrollLeft = carouselContainer.scrollLeft;
                
                carouselContainer.scrollTo({
                    left: scrollLeft + (targetCardRect.left - containerRect.left),
                    behavior: 'smooth'
                });
                
                setTimeout(updateCarouselButtonsNuevo, 400);
            }

            if (prevButton && nextButton) {
                // Inicializar estado de los botones
                updateCarouselButtonsNuevo();

                // Botón anterior
                prevButton.addEventListener('click', function() {
                    if (this.disabled) return;
                    scrollToPrevGroupNuevo();
                });

                // Botón siguiente
                nextButton.addEventListener('click', function() {
                    if (this.disabled) return;
                    scrollToNextGroupNuevo();
                });

                // Actualizar estado al hacer scroll
                carouselContainer.addEventListener('scroll', function() {
                    setTimeout(updateCarouselButtonsNuevo, 100);
                });

                // Actualizar estado al redimensionar la ventana
                window.addEventListener('resize', function() {
                    setTimeout(updateCarouselButtonsNuevo, 100);
                });
            }
        }

        // Event delegation para evitar listeners duplicados
        let catalogEventListenersAttached = false;
        
        function attachCatalogEventListeners() {
            // Solo agregar listeners una vez usando event delegation
            if (catalogEventListenersAttached) return;
            catalogEventListenersAttached = true;
            
            const resultsContainer = document.getElementById('catalog-results');
            
            // Event delegation para academias
            resultsContainer.addEventListener('click', function(e) {
                const academiaCard = e.target.closest('.academia-card-spotify');
                if (academiaCard) {
                    e.stopPropagation();
                    const academiaNombre = academiaCard.dataset.academia;
                    const competenciasContainer = document.querySelector(`.academia-competencias-container[data-academia="${academiaNombre}"]`);
                    const isCurrentlyExpanded = academiaCard.classList.contains('expanded');
                    
                    // Cerrar todas las academias abiertas
                    document.querySelectorAll('.academia-card-spotify.expanded').forEach(openCard => {
                        if (openCard !== academiaCard) {
                            openCard.classList.remove('expanded');
                            const openAcademiaNombre = openCard.dataset.academia;
                            const openContainer = document.querySelector(`.academia-competencias-container[data-academia="${openAcademiaNombre}"]`);
                            if (openContainer) {
                                openContainer.classList.remove('is-visible');
                            }
                        }
                    });
                    
                    // Toggle la academia clickeada
                    if (competenciasContainer) {
                        if (isCurrentlyExpanded) {
                            // Si ya estaba abierta, cerrarla
                            academiaCard.classList.remove('expanded');
                            competenciasContainer.classList.remove('is-visible');
                        } else {
                            // Si estaba cerrada, abrirla
                            academiaCard.classList.add('expanded');
                            competenciasContainer.classList.add('is-visible');
                            
                            // Scroll suave al contenedor (sin causar resize)
                            requestAnimationFrame(() => {
                                competenciasContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                            });
                        }
                    }
                    return;
                }
                
                // Event delegation para competencias
                const competenciaCard = e.target.closest('.competencia-card-v1');
                if (competenciaCard) {
                    // Si el clic fue en el botón de filtro, no hacer nada
                    if (e.target.closest('.ubits-button[data-tooltip="Filtrar por esta competencia"]')) {
                        return;
                    }
                    
                    e.stopPropagation();
                    const competenciaNombre = competenciaCard.dataset.competencia;
                    const academiaNombre = competenciaCard.dataset.academia;
                    const habilidadesContainer = document.querySelector(`.competencia-habilidades-container[data-competencia="${competenciaNombre}"][data-academia="${academiaNombre}"]`);
                    const chevronBtn = competenciaCard.querySelector('.competencia-card-v1-chevron-btn');
                    const chevronIcon = chevronBtn ? chevronBtn.querySelector('.competencia-card-v1-chevron') : null;
                    const isCurrentlyExpanded = competenciaCard.classList.contains('expanded');
                    
                    // Cerrar todas las competencias expandidas
                    document.querySelectorAll('.competencia-card-v1.expanded').forEach(openCard => {
                        if (openCard !== competenciaCard) {
                            openCard.classList.remove('expanded');
                            const openCompetenciaNombre = openCard.dataset.competencia;
                            const openAcademiaNombre = openCard.dataset.academia;
                            const openContainer = document.querySelector(`.competencia-habilidades-container[data-competencia="${openCompetenciaNombre}"][data-academia="${openAcademiaNombre}"]`);
                            if (openContainer) {
                                openContainer.classList.remove('is-visible');
                            }
                            // Resetear chevron de otras cards
                            const openChevronBtn = openCard.querySelector('.competencia-card-v1-chevron-btn');
                            if (openChevronBtn) {
                                const openChevronIcon = openChevronBtn.querySelector('.competencia-card-v1-chevron');
                                if (openChevronIcon) {
                                    openChevronIcon.style.transform = '';
                                }
                            }
                        }
                    });
                    
                    // Toggle la competencia clickeada
                    if (habilidadesContainer) {
                        if (isCurrentlyExpanded) {
                            // Si ya estaba expandida, colapsarla
                            competenciaCard.classList.remove('expanded');
                            habilidadesContainer.classList.remove('is-visible');
                            if (chevronIcon) {
                                chevronIcon.style.transform = '';
                            }
                        } else {
                            // Si estaba colapsada, expandirla
                            competenciaCard.classList.add('expanded');
                            habilidadesContainer.classList.add('is-visible');
                            if (chevronIcon) {
                                chevronIcon.style.transform = 'rotate(180deg)';
                            }
                        }
                    }
                    return;
                }
                
                // Event delegation para botón de filtro
                const filterButton = e.target.closest('.ubits-button[data-tooltip="Filtrar por esta competencia"]');
                if (filterButton) {
                    e.stopPropagation();
                    // No hacer nada, esta funcionalidad se implementará en el futuro
                    return;
                }
            });
        }
        
        function renderCatalog(academias) {
            const resultsContainer = document.getElementById('catalog-results');
            
            if (academias.length === 0) {
                resultsContainer.innerHTML = '';
                return;
            }

            // Renderizar grid de academias
            let academiasHtml = '<div class="academias-grid-spotify">';
            
            academias.forEach(academia => {
                const totalCompetencias = academia.competencias.length;
                // Dividir el nombre: "Academia de" arriba, resto abajo
                const nombreCompleto = academia.nombre;
                const partes = nombreCompleto.split('Academia de ');
                const prefijo = 'Academia de';
                const resto = partes.length > 1 ? partes[1] : nombreCompleto;
                
                // Obtener imagen
                const academiaImage = academiaImageMap[academia.nombre] || 'https://images.unsplash.com/photo-1451187580459-43490279c0fa?w=400&h=400&fit=crop';
                
                // Todas las academias usan variante con imagen arriba
                academiasHtml += `
                    <div class="academia-card-spotify variant-image-top" data-academia="${academia.nombre}">
                        <img src="${academiaImage}" alt="${academia.nombre}" class="academia-card-spotify-image">
                        <div class="academia-card-spotify-content">
                            <p class="ubits-body-md-semibold academia-card-spotify-title">
                                <span>${prefijo}</span><br>
                                <span>${resto}</span>
                            </p>
                            <p class="ubits-body-sm-regular academia-card-spotify-meta">${totalCompetencias} competencias</p>
                        </div>
                    </div>
                `;
            });
            
            academiasHtml += '</div>';

            // Renderizar contenedores de competencias (inicialmente ocultos)
            let competenciasHtml = '';
            
            academias.forEach(academia => {
                // Ordenar competencias alfabéticamente
                const competenciasOrdenadas = [...academia.competencias].sort((a, b) => 
                    a.nombre.localeCompare(b.nombre, 'es', { sensitivity: 'base' })
                );
                
                // Determinar número de columnas según el ancho de la pantalla
                let numColumns = 3; // Desktop por defecto
                if (window.innerWidth <= 768) {
                    numColumns = 1; // Mobile
                } else if (window.innerWidth <= 1023) {
                    numColumns = 2; // Tablet
                }
                
                const columns = [];
                for (let i = 0; i < numColumns; i++) {
                    columns[i] = [];
                }
                
                // Distribuir competencias en columnas para lectura de izquierda a derecha y arriba hacia abajo
                competenciasOrdenadas.forEach((competencia, index) => {
                    const columnIndex = index % numColumns;
                    columns[columnIndex].push(competencia);
                });

                competenciasHtml += `
                    <div class="academia-competencias-container" data-academia="${academia.nombre}">
                        <div class="competencias-grid-v1">
                            ${columns.map(column => `
                                <div class="competencias-column">
                                    ${column.map(competencia => {
                                        const imageName = competenciaImageMap[competencia.nombre] || 'Accountability.jpg';
                                        const imagePath = `images/imagenes competencias/${imageName}`;
                                        const isAssigned = competenciasAsignadas.includes(competencia.nombre);
                                        return `
                                            <div class="competencia-card-v1-wrapper">
                                                <div class="competencia-card-v1 ${isAssigned ? 'is-assigned' : ''}" data-competencia="${competencia.nombre}" data-academia="${academia.nombre}">
                                                    <img src="${imagePath}" alt="${competencia.nombre}" class="competencia-card-v1-image" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1451187580459-43490279c0fa?w=400&h=300&fit=crop'">
                                                    <div class="competencia-card-v1-content">
                                                        <div class="competencia-card-v1-title-wrapper">
                                                            <p class="ubits-body-sm-semibold competencia-card-v1-title">
                                                                <span class="competencia-card-v1-title-text">${competencia.nombre}</span>
                                                                ${isAssigned ? '<span class="ubits-status-tag ubits-status-tag--info ubits-status-tag--xs"><span class="ubits-status-tag__text">Asignado</span></span>' : ''}
                                                            </p>
                                                        </div>
                                                        <p class="ubits-body-xs-regular competencia-card-v1-count">${competencia.habilidades.length} habilidades</p>
                                                    </div>
                                                    <div class="competencia-card-v1-actions">
                                                        <button class="ubits-button ubits-button--tertiary ubits-button--xs ubits-button--icon-only" aria-label="Filtrar por esta competencia" data-tooltip="Filtrar por esta competencia">
                                                            <i class="far fa-filter"></i>
                                                        </button>
                                                        <button class="ubits-button ubits-button--tertiary ubits-button--xs ubits-button--icon-only competencia-card-v1-chevron-btn" aria-label="Ver habilidades" data-competencia="${competencia.nombre}" data-academia="${academia.nombre}" data-tooltip="Ver habilidades">
                                                            <i class="far fa-chevron-down competencia-card-v1-chevron"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="competencia-habilidades-container" data-competencia="${competencia.nombre}" data-academia="${academia.nombre}">
                                                    <div class="competencias-habilidades-grid">
                                                        ${competencia.habilidades.sort((a, b) => a.localeCompare(b, 'es', { sensitivity: 'base' })).map(habilidad => {
                                                            const icon = habilidadIconMap[habilidad] || 'fa-circle';
                                                            return `
                                                                <div class="habilidad-chip">
                                                                    <i class="far ${icon}"></i>
                                                                    <span class="ubits-body-sm-regular">${habilidad}</span>
                                                                </div>
                                                            `;
                                                        }).join('')}
                                                    </div>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });

            resultsContainer.innerHTML = academiasHtml + competenciasHtml;
            
            // Asegurar que los event listeners estén adjuntos (solo una vez)
            attachCatalogEventListeners();

            document.querySelectorAll('.competencia-card-v1-actions .ubits-button').forEach(button => {
                button.addEventListener('mouseenter', function() {
                    const tooltipText = this.getAttribute('data-tooltip');
                    if (!tooltipText) return;
                    
                    // Crear tooltip temporal para calcular dimensiones
                    const tempTooltip = document.createElement('div');
                    tempTooltip.textContent = tooltipText;
                    tempTooltip.style.cssText = 'position: absolute; visibility: hidden; white-space: nowrap; padding: 6px 10px; font-size: 12px; font-family: "Noto Sans", sans-serif;';
                    document.body.appendChild(tempTooltip);
                    const tooltipWidth = tempTooltip.offsetWidth;
                    const tooltipHeight = tempTooltip.offsetHeight;
                    document.body.removeChild(tempTooltip);
                    
                    const rect = this.getBoundingClientRect();
                    const viewportWidth = window.innerWidth;
                    const viewportHeight = window.innerHeight;
                    const margin = 10;
                    
                    // Determinar posición
                    const spaceAbove = rect.top;
                    const spaceBelow = viewportHeight - rect.bottom;
                    const spaceRight = viewportWidth - rect.right;
                    const spaceLeft = rect.left;
                    
                    // Resetear clases
                    this.classList.remove('tooltip-top', 'tooltip-bottom', 'tooltip-left', 'tooltip-right');
                    
                    // Determinar posición vertical
                    const useBottom = spaceAbove < tooltipHeight + margin;
                    
                    // Determinar posición horizontal
                    let horizontalPos = 'center';
                    if (spaceRight < tooltipWidth / 2 + margin) {
                        horizontalPos = 'right';
                    } else if (spaceLeft < tooltipWidth / 2 + margin) {
                        horizontalPos = 'left';
                    }
                    
                    // Aplicar clases
                    if (useBottom) {
                        this.classList.add('tooltip-bottom');
                    }
                    if (horizontalPos === 'right') {
                        this.classList.add('tooltip-right');
                    } else if (horizontalPos === 'left') {
                        this.classList.add('tooltip-left');
                    }
                });
            });

        }

    </script>
</body>
</html>

