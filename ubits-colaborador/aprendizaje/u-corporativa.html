<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="../../images/Ubits-logo-dark.svg">
    <title>UBITS Playground - Dashboard</title>
    
    <!-- Estilos locales -->
    <link rel="stylesheet" href="../../general-styles/ubits-colors.css">
    <link rel="stylesheet" href="../../general-styles/styles.css">
    <link rel="stylesheet" href="../../general-styles/fontawesome-icons.css">
    <link rel="stylesheet" href="../../general-styles/ubits-typography.css">
    <link rel="stylesheet" href="../../components/sub-nav.css">
    <link rel="stylesheet" href="../../components/sidebar.css">
    <link rel="stylesheet" href="../../components/tab-bar.css">
    <link rel="stylesheet" href="../../components/floating-menu.css">
    <link rel="stylesheet" href="../../components/profile-menu.css">
    <link rel="stylesheet" href="../../components/avatar.css">
    <link rel="stylesheet" href="../../components/card-content.css">
    <link rel="stylesheet" href="../../components/button.css">
    <link rel="stylesheet" href="../../components/input.css">
    <link rel="stylesheet" href="../../components/paginator.css">
    <link rel="stylesheet" href="../../components/empty-state.css">
    <link rel="stylesheet" href="../../components/tooltip.css">
    <link rel="stylesheet" href="./profile.css">
    <link rel="stylesheet" href="./u-corporativa.css">
</head>
<body data-theme="light">
    <div class="dashboard-container">
        <div class="tooltip" id="tooltip"></div>
        
        <!-- Sidebar Container -->
        <div id="sidebar-container"></div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Navigation -->
            <div id="top-nav-container"></div>
            <!-- Content Area -->
            <div class="content-area">
                <!-- Content wrapper con secciones de widgets -->
                <div class="content-sections">
                    <!-- Sección encabezado universidad corporativa -->
                    <div class="section-single">
                        <div class="widget-encabezado-universidad">
                            <div class="encabezado-banner">
                                <img src="../../images/banner-u-corporativa.jpg" alt="Universidad Corporativa">
                            </div>
                            <div class="encabezado-content">
                                <h1 class="encabezado-title">Contenidos de mi empresa</h1>
                                <p class="encabezado-description">Encuentra los contenidos formativos creados por la empresa, pensados para todos nuestros colaboradores.</p>
                                <div class="encabezado-button-wrapper">
                                    <button class="ubits-button ubits-button--secondary ubits-button--md">
                                        <i class="far fa-bolt"></i>
                                        <span>Acceder al creador</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección buscador y filtros -->
                    <div class="section-single">
                        <div class="widget-buscador-filtros">
                            <div class="buscador-header">
                                <div class="buscador-title-container">
                                    <h2 class="buscador-title">Lista de contenidos</h2>
                                    <div class="buscador-results">
                                        <span class="buscador-results-count" id="buscador-results-count">0</span>
                                        <span class="buscador-results-text">resultados</span>
                                    </div>
                                </div>
                                <div class="buscador-actions">
                                    <div id="buscador-input-container" style="display: none;"></div>
                                    <button id="buscador-toggle-btn" class="ubits-button ubits-button--secondary ubits-button--md ubits-button--icon-only">
                                        <i class="far fa-search"></i>
                                    </button>
                                    <button class="ubits-button ubits-button--secondary ubits-button--md ubits-button--icon-only">
                                        <i class="far fa-filter"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sección grid cards cursos propios -->
                    <div class="section-single">
                        <div class="widget-grid-cursos-propios">
                            <div class="grid-cards-container" id="cursos-corporativos-container"></div>
                            <div class="paginador-container" id="paginador-container"></div>
                        </div>
                        <div id="empty-state-no-results" style="display: none;"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Tab Bar Container -->
    <div id="tab-bar-container"></div>

    <!-- Floating Menu Container -->
    <div id="floating-menu-container"></div>
    
    <!-- Profile Menu Container -->
    <div id="profile-menu-container"></div>

        <script src="../../components/tooltip.js"></script>
<script src="../../components/sidebar.js"></script>
    <script src="../../components/sub-nav.js"></script>
    <script src="../../components/tab-bar.js"></script>
    <script src="../../components/floating-menu.js"></script>
    <script src="../../components/profile-menu.js"></script>
    <script src="../../components/avatar.js"></script>
    <script src="../../components/card-content.js"></script>
    <script src="../../components/input.js"></script>
    <script src="../../components/paginator.js"></script>
    <script src="../../components/empty-state.js"></script>
    <script src="../../script.js"></script>
    <script>
        // Cargar componentes dinámicamente
        document.addEventListener('DOMContentLoaded', function() {
            loadSidebar('sidebar-container', 'aprendizaje');
            loadSubNav('top-nav-container', 'aprendizaje');
            loadTabBar('tab-bar-container');
            loadFloatingMenu('floating-menu-container');
            loadProfileMenu('profile-menu-container');
            
            // Activar el tab "U. Corporativa" específicamente después de cargar el SubNav
            setTimeout(() => {
                // Remover active de todos los tabs (desktop y móvil)
                document.querySelectorAll('.nav-tab, .hamburger-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                // Activar el tab U. Corporativa en desktop
                const corporateTab = document.querySelector('.nav-tab[data-tab="corporate"]');
                if (corporateTab) {
                    corporateTab.classList.add('active');
                }
                
                // Activar el tab U. Corporativa en móvil (hamburger menu)
                const corporateHamburger = document.querySelector('.hamburger-item[data-tab="corporate"]');
                if (corporateHamburger) {
                    corporateHamburger.classList.add('active');
                }
                
                // Activar el botón de aprendizaje en el sidebar
                const aprendizajeButton = document.querySelector('.nav-button[data-section="aprendizaje"]');
                if (aprendizajeButton) {
                    // Remover active de todos los botones del sidebar
                    document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active'));
                    // Activar el botón de aprendizaje
                    aprendizajeButton.classList.add('active');
                }
                
                // Activar el botón "Módulos" del Tab-bar móvil
                const modulosTabBarItem = document.querySelector('.tab-bar-item[data-tab="modulos"]');
                if (modulosTabBarItem) {
                    // Remover active de todos los items del tab-bar
                    document.querySelectorAll('.tab-bar-item').forEach(item => item.classList.remove('active'));
                    // Activar el item módulos
                    modulosTabBarItem.classList.add('active');
                }
                
                // Activar la opción "U. Corporativa" dentro del grupo "Aprendizaje" del floating menu
                if (typeof setActiveAccordionLink === 'function') {
                    setActiveAccordionLink('corporativa');
                }
            }, 200);

            // Datos de los cursos corporativos según Figma
            const cursosCorporativos = [
                {
                    type: 'Curso',
                    title: 'Inducción a la cultura y valores corporativos',
                    provider: 'Figsha Smart Consulting',
                    providerLogo: '../../images/Favicons/Figsha Smart Consulting.jpg',
                    duration: '60 min',
                    level: 'Básico',
                    progress: 0,
                    status: 'default',
                    image: '../../images/cards-learn/U-Corporativa/Inducción-a-la-cultura-y-valores-corporativos.jpg',
                    competency: 'Liderazgo',
                    language: 'Español'
                },
                {
                    type: 'Curso',
                    title: 'Prevención del acoso laboral',
                    provider: 'Figsha Smart Consulting',
                    providerLogo: '../../images/Favicons/Figsha Smart Consulting.jpg',
                    duration: '60 min',
                    level: 'Básico',
                    progress: 0,
                    status: 'default',
                    image: '../../images/cards-learn/U-Corporativa/prevencion-acoso-laboral.jpg',
                    competency: 'Liderazgo',
                    language: 'Español'
                },
                {
                    type: 'Curso',
                    title: 'Seguridad y salud en el trabajo 2025',
                    provider: 'Figsha Smart Consulting',
                    providerLogo: '../../images/Favicons/Figsha Smart Consulting.jpg',
                    duration: '60 min',
                    level: 'Básico',
                    progress: 0,
                    status: 'default',
                    image: '../../images/cards-learn/U-Corporativa/seguridad-y-salud-en-el-trabajo.jpg',
                    competency: 'Liderazgo',
                    language: 'Español'
                },
                {
                    type: 'Curso',
                    title: 'Cumplimiento normativo y código de conducta',
                    provider: 'Figsha Smart Consulting',
                    providerLogo: '../../images/Favicons/Figsha Smart Consulting.jpg',
                    duration: '60 min',
                    level: 'Básico',
                    progress: 0,
                    status: 'default',
                    image: '../../images/cards-learn/U-Corporativa/Cumplimiento-normativo-y-código-de-conducta.jpg',
                    competency: 'Liderazgo',
                    language: 'Español'
                },
                {
                    type: 'Curso',
                    title: 'Comunicación efectiva en el trabajo',
                    provider: 'Figsha Smart Consulting',
                    providerLogo: '../../images/Favicons/Figsha Smart Consulting.jpg',
                    duration: '60 min',
                    level: 'Básico',
                    progress: 0,
                    status: 'default',
                    image: '../../images/cards-learn/U-Corporativa/Comunicación-efectiva-en-el-trabajo.jpg',
                    competency: 'Comunicación',
                    language: 'Español'
                },
                {
                    type: 'Curso',
                    title: 'Gestión del tiempo y productividad',
                    provider: 'Figsha Smart Consulting',
                    providerLogo: '../../images/Favicons/Figsha Smart Consulting.jpg',
                    duration: '60 min',
                    level: 'Básico',
                    progress: 0,
                    status: 'default',
                    image: '../../images/cards-learn/U-Corporativa/gestion-del-tiempo-y-productividad.jpg',
                    competency: 'Comunicación',
                    language: 'Español'
                },
                {
                    type: 'Curso',
                    title: 'Resolución efectiva de conflictos en equipos de trabajo',
                    provider: 'Figsha Smart Consulting',
                    providerLogo: '../../images/Favicons/Figsha Smart Consulting.jpg',
                    duration: '60 min',
                    level: 'Básico',
                    progress: 0,
                    status: 'default',
                    image: '../../images/cards-learn/U-Corporativa/resolucion-de-conflictos.jpg',
                    competency: 'Comunicación',
                    language: 'Español'
                },
                {
                    type: 'Curso',
                    title: 'Pensamiento crítico y toma de decisiones',
                    provider: 'Figsha Smart Consulting',
                    providerLogo: '../../images/Favicons/Figsha Smart Consulting.jpg',
                    duration: '90 min',
                    level: 'Intermedio',
                    progress: 0,
                    status: 'default',
                    image: '../../images/cards-learn/U-Corporativa/Pensamiento-crítico-y-toma-de-decisiones.jpg',
                    competency: 'Comunicación',
                    language: 'Español'
                },
                {
                    type: 'Curso',
                    title: 'Creatividad e innovación',
                    provider: 'Figsha Smart Consulting',
                    providerLogo: '../../images/Favicons/Figsha Smart Consulting.jpg',
                    duration: '60 min',
                    level: 'Básico',
                    progress: 0,
                    status: 'default',
                    image: '../../images/cards-learn/U-Corporativa/creatividad-e-innovacion.jpg',
                    competency: 'Comunicación',
                    language: 'Español'
                },
                {
                    type: 'Curso',
                    title: 'Presentaciones de alto impacto',
                    provider: 'Figsha Smart Consulting',
                    providerLogo: '../../images/Favicons/Figsha Smart Consulting.jpg',
                    duration: '60 min',
                    level: 'Básico',
                    progress: 0,
                    status: 'default',
                    image: '../../images/cards-learn/U-Corporativa/presentaciones-de-alto-impacto.jpg',
                    competency: 'Comunicación',
                    language: 'Español'
                },
                {
                    type: 'Curso',
                    title: 'Manejo del estrés laboral',
                    provider: 'Figsha Smart Consulting',
                    providerLogo: '../../images/Favicons/Figsha Smart Consulting.jpg',
                    duration: '30 min',
                    level: 'Básico',
                    progress: 0,
                    status: 'default',
                    image: '../../images/cards-learn/U-Corporativa/manejo-del-estres-laboral.jpg',
                    competency: 'Comunicación',
                    language: 'Español'
                },
                {
                    type: 'Curso',
                    title: 'Trabajo en equipo y colaboración',
                    provider: 'Figsha Smart Consulting',
                    providerLogo: '../../images/Favicons/Figsha Smart Consulting.jpg',
                    duration: '60 min',
                    level: 'Básico',
                    progress: 0,
                    status: 'default',
                    image: '../../images/cards-learn/U-Corporativa/trabajo-en-equipo.jpg',
                    competency: 'Comunicación',
                    language: 'Español'
                },
                {
                    type: 'Curso',
                    title: 'Gestión de equipos remotos e híbridos',
                    provider: 'Figsha Smart Consulting',
                    providerLogo: '../../images/Favicons/Figsha Smart Consulting.jpg',
                    duration: '60 min',
                    level: 'Básico',
                    progress: 0,
                    status: 'default',
                    image: '../../images/cards-learn/U-Corporativa/gestion-equipos-remotos.jpg',
                    competency: 'Liderazgo',
                    language: 'Español'
                },
                {
                    type: 'Curso',
                    title: 'Delegación efectiva',
                    provider: 'Figsha Smart Consulting',
                    providerLogo: '../../images/Favicons/Figsha Smart Consulting.jpg',
                    duration: '60 min',
                    level: 'Básico',
                    progress: 0,
                    status: 'default',
                    image: '../../images/cards-learn/U-Corporativa/delegacion-efectiva.jpg',
                    competency: 'Liderazgo',
                    language: 'Español'
                },
                {
                    type: 'Curso',
                    title: 'Cómo dar y recibir feedback',
                    provider: 'Figsha Smart Consulting',
                    providerLogo: '../../images/Favicons/Figsha Smart Consulting.jpg',
                    duration: '60 min',
                    level: 'Básico',
                    progress: 0,
                    status: 'default',
                    image: '../../images/cards-learn/U-Corporativa/dar-y-recibir-feedback.jpg',
                    competency: 'Liderazgo',
                    language: 'Español'
                },
                {
                    type: 'Curso',
                    title: 'Comunicación asertiva para líderes',
                    provider: 'Figsha Smart Consulting',
                    providerLogo: '../../images/Favicons/Figsha Smart Consulting.jpg',
                    duration: '60 min',
                    level: 'Básico',
                    progress: 0,
                    status: 'default',
                    image: '../../images/cards-learn/U-Corporativa/Comunicación-asertiva-para-líderes.jpg',
                    competency: 'Liderazgo',
                    language: 'Español'
                },
                {
                    type: 'Curso',
                    title: 'Ciberseguridad y protección de datos',
                    provider: 'Figsha Smart Consulting',
                    providerLogo: '../../images/Favicons/Figsha Smart Consulting.jpg',
                    duration: '60 min',
                    level: 'Básico',
                    progress: 0,
                    status: 'default',
                    image: '../../images/cards-learn/U-Corporativa/Ciberseguridad-y-protección-de-datos.jpg',
                    competency: 'Herramientas tecnológicas',
                    language: 'Español'
                },
                {
                    type: 'Curso',
                    title: 'Gestión de proyectos con metodologías ágiles',
                    provider: 'Figsha Smart Consulting',
                    providerLogo: '../../images/Favicons/Figsha Smart Consulting.jpg',
                    duration: '60 min',
                    level: 'Básico',
                    progress: 0,
                    status: 'default',
                    image: '../../images/cards-learn/U-Corporativa/Gestión-de-proyectos-con-metodologías-ágiles.jpg',
                    competency: 'Herramientas tecnológicas',
                    language: 'Español'
                },
                {
                    type: 'Curso',
                    title: 'Uso eficiente del correo electrónico y calendarios',
                    provider: 'Figsha Smart Consulting',
                    providerLogo: '../../images/Favicons/Figsha Smart Consulting.jpg',
                    duration: '60 min',
                    level: 'Básico',
                    progress: 0,
                    status: 'default',
                    image: '../../images/cards-learn/U-Corporativa/Uso-eficiente-del-correo-electrónico-y-calendarios.jpg',
                    competency: 'Herramientas tecnológicas',
                    language: 'Español'
                },
                {
                    type: 'Curso',
                    title: 'Motivación y reconocimiento del talento',
                    provider: 'Figsha Smart Consulting',
                    providerLogo: '../../images/Favicons/Figsha Smart Consulting.jpg',
                    duration: '60 min',
                    level: 'Básico',
                    progress: 0,
                    status: 'default',
                    image: '../../images/cards-learn/U-Corporativa/motivacion-y-reconocimiento-del-talento.jpg',
                    competency: 'Liderazgo',
                    language: 'Español'
                }
            ];

            // Configuración de paginación usando componente oficial UBITS Paginator
            let currentPage = 1;
            let itemsPerPageValue = 16; // Valor por defecto
            let paginatorInstance = null;
            let cursosFiltrados = [...cursosCorporativos]; // Copia de todos los cursos para filtrado
            let searchQuery = ''; // Texto de búsqueda actual

            // Función para filtrar cursos basándose en el texto de búsqueda
            function filterCourses(searchText) {
                searchQuery = searchText.toLowerCase().trim();
                
                if (searchQuery === '') {
                    // Si no hay búsqueda, mostrar todos los cursos
                    cursosFiltrados = [...cursosCorporativos];
                } else {
                    // Filtrar cursos que coincidan con el texto de búsqueda
                    cursosFiltrados = cursosCorporativos.filter(curso => {
                        // Buscar en título
                        const titleMatch = curso.title.toLowerCase().includes(searchQuery);
                        // Buscar en competencia
                        const competencyMatch = curso.competency.toLowerCase().includes(searchQuery);
                        // Buscar en tipo de contenido
                        const typeMatch = curso.type.toLowerCase().includes(searchQuery);
                        // Buscar en nivel
                        const levelMatch = curso.level.toLowerCase().includes(searchQuery);
                        
                        return titleMatch || competencyMatch || typeMatch || levelMatch;
                    });
                }
                
                // Resetear a la primera página cuando se filtra
                currentPage = 1;
                
                // Re-renderizar cards y actualizar paginador
                renderCards();
                updatePaginator();
            }

            // Función para actualizar el contador de resultados
            function updateResultsCount() {
                const resultsCountElement = document.getElementById('buscador-results-count');
                if (resultsCountElement) {
                    resultsCountElement.textContent = cursosFiltrados.length;
                }
            }

            // Función para renderizar cards de la página actual
            function renderCards() {
                const container = document.getElementById('cursos-corporativos-container');
                const emptyStateContainer = document.getElementById('empty-state-no-results');
                if (!container) return;

                // Si no hay resultados, mostrar empty state
                if (cursosFiltrados.length === 0) {
                    // Ocultar el grid de cards
                    container.style.display = 'none';
                    
                    // Mostrar y cargar empty state component
                    if (emptyStateContainer) {
                        emptyStateContainer.style.display = 'flex'; // Usar flex para que gap funcione
                        
                        if (typeof loadEmptyState === 'function') {
                            loadEmptyState('empty-state-no-results', {
                                icon: 'fa-search',
                                iconSize: 'lg',
                                title: 'No se encontraron resultados',
                                description: 'Intenta ajustar tu búsqueda o filtros para encontrar lo que buscas.',
                                buttons: {
                                    primary: {
                                        text: 'Limpiar búsqueda',
                                        icon: 'fa-times',
                                        onClick: function() {
                                            // Placeholder, manejaremos el click directamente
                                        }
                                    }
                                }
                            });
                            
                            // Agregar event listener directo al botón (KISS approach)
                            setTimeout(() => {
                                const clearBtn = emptyStateContainer.querySelector('.ubits-button--primary');
                                if (clearBtn) {
                                    clearBtn.onclick = function(e) {
                                        e.preventDefault();
                                        e.stopPropagation();
                                        if (typeof window.clearSearchUCorporativa === 'function') {
                                            window.clearSearchUCorporativa();
                                        }
                                    };
                                }
                            }, 50);
                        }
                    }
                    
                    // Ocultar paginador cuando no hay resultados
                    const paginatorContainer = document.getElementById('paginador-container');
                    if (paginatorContainer) {
                        paginatorContainer.style.display = 'none';
                    }
                    
                    // Actualizar contador de resultados
                    updateResultsCount();
                    return;
                }

                // Si hay resultados, ocultar empty state y mostrar las cards
                if (emptyStateContainer) {
                    emptyStateContainer.style.display = 'none';
                    emptyStateContainer.innerHTML = ''; // Limpiar contenido del empty state
                    emptyStateContainer.className = ''; // Limpiar clases también
                }
                
                container.style.display = 'grid';
                
                if (typeof loadCardContent === 'function') {
                    const startIndex = (currentPage - 1) * itemsPerPageValue;
                    const endIndex = startIndex + itemsPerPageValue;
                    const pageCards = cursosFiltrados.slice(startIndex, endIndex);

                    loadCardContent('cursos-corporativos-container', pageCards);
                }
                
                // Mostrar paginador cuando hay resultados
                const paginatorContainer = document.getElementById('paginador-container');
                if (paginatorContainer) {
                    paginatorContainer.style.display = 'flex'; // Usar flex para centrar
                }
                
                // Actualizar contador de resultados
                updateResultsCount();
            }

            // Función para actualizar el paginador con el nuevo total de items
            function updatePaginator() {
                if (paginatorInstance) {
                    paginatorInstance.updateTotalItems(cursosFiltrados.length);
                } else {
                    // Si el paginador aún no existe, inicializarlo
                    initializePaginator();
                }
            }

            // Inicializar paginador usando componente oficial UBITS
            function initializePaginator() {
                const container = document.getElementById('paginador-container');
                if (!container || typeof loadPaginator !== 'function') return;

                paginatorInstance = loadPaginator('paginador-container', {
                    totalItems: cursosFiltrados.length,
                    itemsPerPage: itemsPerPageValue,
                    currentPage: currentPage,
                    itemsPerPageOptions: [16, 20, 32, 48],
                    onPageChange: function(page) {
                        currentPage = page;
                        renderCards();
                        
                        // Scroll suave hacia arriba
                        window.scrollTo({
                            top: 0,
                            behavior: 'smooth'
                        });
                    },
                    onItemsPerPageChange: function(newItemsPerPage) {
                        itemsPerPageValue = newItemsPerPage;
                        currentPage = 1; // Resetear a la primera página
                        renderCards();
                        
                        // Actualizar el paginador con el nuevo total de páginas
                        if (paginatorInstance) {
                            paginatorInstance.updateTotalItems(cursosFiltrados.length);
                        }
                    }
                });
            }

            // Funcionalidad del botón de búsqueda
            const buscadorToggleBtn = document.getElementById('buscador-toggle-btn');
            const buscadorInputContainer = document.getElementById('buscador-input-container');
            const buscadorActions = buscadorInputContainer?.closest('.buscador-actions');
            let searchInputInstance = null;
            let isSearchMode = false;
            let currentSearchValue = ''; // Almacenar el valor actual de búsqueda
            
            // Función para limpiar la búsqueda (usada por el botón X y el empty state)
            // Hacerla global para que el botón del empty state pueda accederla
            window.clearSearchUCorporativa = function() {
                currentSearchValue = '';
                
                // Asegurarse de que el empty state se oculte antes de filtrar
                const emptyStateContainer = document.getElementById('empty-state-no-results');
                if (emptyStateContainer) {
                    emptyStateContainer.style.display = 'none';
                    emptyStateContainer.innerHTML = '';
                    emptyStateContainer.className = '';
                }
                
                filterCourses('');
                
                // Si el input está abierto, cerrarlo también
                if (isSearchMode) {
                    buscadorInputContainer.innerHTML = '';
                    buscadorInputContainer.style.display = 'none';
                    buscadorToggleBtn.style.display = 'flex';
                    isSearchMode = false;
                    searchInputInstance = null;
                }
            };
            
            // Alias local para mantener compatibilidad
            const clearSearch = window.clearSearchUCorporativa;
            
            // Cargar cards iniciales y paginador
            renderCards();
            initializePaginator();
            
            // Actualizar contador de resultados inicial
            updateResultsCount();
            
            // Función para cerrar el input de búsqueda
            function closeSearchInput(clearSearchParam = true) {
                if (isSearchMode) {
                    buscadorInputContainer.innerHTML = '';
                    buscadorInputContainer.style.display = 'none';
                    buscadorToggleBtn.style.display = 'flex';
                    // Remover clase cuando se cierra el buscador
                    if (buscadorActions) {
                        buscadorActions.classList.remove('search-mode-active');
                    }
                    isSearchMode = false;
                    searchInputInstance = null;
                    
                    // Limpiar búsqueda y restaurar todos los cursos solo si se solicita
                    if (clearSearchParam) {
                        currentSearchValue = '';
                        filterCourses('');
                    }
                }
            }
            
            // Función para verificar si hay texto en el input de búsqueda
            function hasSearchText() {
                // Usar la variable almacenada en lugar de leer del DOM
                return currentSearchValue.trim() !== '';
            }
            
            if (buscadorToggleBtn && buscadorInputContainer) {
                buscadorToggleBtn.addEventListener('click', function(e) {
                    e.stopPropagation(); // Prevenir que el clic se propague
                    if (!isSearchMode) {
                        // Convertir botón en input de búsqueda
                        buscadorToggleBtn.style.display = 'none';
                        buscadorInputContainer.style.display = 'block';
                        // Agregar clase para indicar que el buscador está activo (para CSS)
                        if (buscadorActions) {
                            buscadorActions.classList.add('search-mode-active');
                        }
                        
                        // Crear input de búsqueda UBITS
                        if (typeof createInput === 'function') {
                            searchInputInstance = createInput({
                                containerId: 'buscador-input-container',
                                type: 'search',
                                placeholder: 'Buscar contenidos...',
                                size: 'md',
                                onChange: function(value) {
                                    // Almacenar el valor actual
                                    currentSearchValue = value || '';
                                    // Ejecutar búsqueda cuando el usuario escribe
                                    filterCourses(value);
                                }
                            });
                            
                            // Agregar botón para cerrar búsqueda y focus automático
                            setTimeout(() => {
                                const inputWrapper = buscadorInputContainer.querySelector('.ubits-input-wrapper');
                                if (inputWrapper) {
                                    const closeBtn = document.createElement('button');
                                    closeBtn.className = 'ubits-button ubits-button--secondary ubits-button--sm ubits-button--icon-only';
                                    closeBtn.style.marginLeft = '8px';
                                    closeBtn.innerHTML = '<i class="far fa-times"></i>';
                                    closeBtn.addEventListener('click', function(e) {
                                        e.stopPropagation(); // Prevenir que el clic se propague
                                        clearSearch(); // Limpiar búsqueda y cerrar input
                                    });
                                    buscadorInputContainer.appendChild(closeBtn);
                                    
                                    // Focus automático en el input
                                    const inputElement = inputWrapper.querySelector('input');
                                    if (inputElement) {
                                        inputElement.focus();
                                    }
                                }
                            }, 100);
                            
                            isSearchMode = true;
                        }
                    }
                });
                
                // Detectar clics fuera del input para cerrarlo (solo si no hay búsqueda activa)
                document.addEventListener('click', function(e) {
                    if (isSearchMode) {
                        const isClickInside = buscadorInputContainer.contains(e.target) || 
                                             buscadorToggleBtn.contains(e.target);
                        if (!isClickInside) {
                            // Verificar si hay texto usando la variable almacenada
                            if (!hasSearchText()) {
                                // Solo cerrar si no hay texto
                                closeSearchInput(true);
                            }
                            // Si hay texto, mantener el input abierto (no hacer nada)
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>

