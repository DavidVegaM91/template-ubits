<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="../../images/Ubits-logo-dark.svg">
    <title>Seguimiento - UBITS Playground</title>

    <!-- Estilos base UBITS -->
    <link rel="stylesheet" href="../../general-styles/ubits-colors.css">
    <link rel="stylesheet" href="../../general-styles/styles.css">
    <link rel="stylesheet" href="../../general-styles/fontawesome-icons.css">
    <link rel="stylesheet" href="../../general-styles/ubits-typography.css">

    <!-- Navegación -->
    <link rel="stylesheet" href="../../components/sub-nav.css">
    <link rel="stylesheet" href="../../components/sidebar.css">
    <link rel="stylesheet" href="../../components/tab-bar.css">
    <link rel="stylesheet" href="../../components/floating-menu.css">
    <link rel="stylesheet" href="../../components/profile-menu.css">

    <!-- Componentes UI -->
    <link rel="stylesheet" href="../../components/button.css">
    <link rel="stylesheet" href="../../components/input.css">
    <link rel="stylesheet" href="../../components/calendar.css">
    <link rel="stylesheet" href="../../components/status-tag.css">
    <link rel="stylesheet" href="../../components/alert.css">
    <link rel="stylesheet" href="../../components/paginator.css">
    <link rel="stylesheet" href="../../components/toast.css">
    <link rel="stylesheet" href="../../components/empty-state.css">
    <link rel="stylesheet" href="../../components/tooltip.css">
    <link rel="stylesheet" href="../../components/avatar.css">
    <link rel="stylesheet" href="../../components/tab.css">
    <link rel="stylesheet" href="../../components/header-product.css">
    <link rel="stylesheet" href="../../components/modal.css">
    <link rel="stylesheet" href="../../components/drawer.css">
    <link rel="stylesheet" href="../../components/table.css">

    <!-- Página + estilos compartidos planes (drawers y menú Crear) -->
    <link rel="stylesheet" href="./seguimiento.css">
    <link rel="stylesheet" href="./planes.css">
</head>
<body data-theme="light">
    <div class="dashboard-container">
        <div class="tooltip" id="tooltip"></div>

        <div id="sidebar-container"></div>

        <main class="main-content">
            <div id="top-nav-container"></div>
            <div class="content-area">
                <div class="content-sections">
                    <!-- Header product: Tabs Tareas | Planes + botón Crear -->
                    <div class="section-single">
                        <div class="widget-header-product" id="header-product-seguimiento"></div>
                    </div>
                    <!-- Header + indicador + botones búsqueda/filtros/columnas -->
                    <div class="section-single">
                        <div class="widget-header-seguimiento">
                            <div class="seguimiento-header-bar">
                                <div class="seguimiento-header-left">
                                    <span class="ubits-body-md-bold" id="seguimiento-header-title">Lista de tareas</span>
                                    <span class="ubits-body-sm-regular" id="seguimiento-results-count">0/100</span>
                                </div>
                                <div class="seguimiento-header-right">
                                    <button type="button" class="ubits-button ubits-button--secondary ubits-button--md ubits-button--icon-only" id="seguimiento-search-toggle" aria-label="Buscar">
                                        <i class="far fa-magnifying-glass"></i>
                                    </button>
                                    <div id="seguimiento-search-container" class="seguimiento-search-inline" style="display: none;"></div>
                                    <button type="button" class="ubits-button ubits-button--secondary ubits-button--md ubits-button--icon-only" id="seguimiento-filters-toggle" aria-label="Filtros">
                                        <i class="far fa-filter"></i>
                                    </button>
                                    <button type="button" class="ubits-button ubits-button--secondary ubits-button--md ubits-button--icon-only" id="seguimiento-columns-toggle" aria-label="Columnas">
                                        <i class="far fa-columns-3"></i>
                                    </button>
                                    <button type="button" class="ubits-button ubits-button--secondary ubits-button--md" id="seguimiento-periodo-toggle" aria-label="Período">
                                        <span id="seguimiento-periodo-text">Últimos 7 días</span>
                                        <i class="far fa-chevron-down"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Filtros aplicados (chips) -->
                            <div class="widget-filtros-aplicados" id="seguimiento-filtros-aplicados" style="display: none;">
                                <span class="ubits-body-sm-regular">Filtros aplicados:</span>
                                <div class="filtros-chips-container" id="filtros-chips-container"></div>
                                <button type="button" class="ubits-button ubits-button--tertiary ubits-button--xs seguimiento-clear-filters-btn" id="seguimiento-clear-filters-btn" aria-label="Limpiar todos los filtros">
                                    <i class="far fa-filter-slash"></i>
                                    <span>Limpiar filtros</span>
                                </button>
                            </div>

                            <!-- Indicadores -->
                            <div class="widget-indicadores-seguimiento" id="seguimiento-indicadores">
                                <!-- Total -->
                                <div class="seguimiento-indicador-card">
                                    <div class="indicador-icon-badge" style="background: var(--ubits-bg-2); border-color: var(--ubits-border-1);">
                                        <i class="far fa-list-check" style="color: var(--ubits-fg-1-medium);"></i>
                                    </div>
                                    <div class="indicador-content">
                                        <div class="indicador-number">140</div>
                                        <div class="indicador-meta">
                                            <span class="indicador-label">Total</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Finalizadas -->
                                <div class="seguimiento-indicador-card">
                                    <div class="indicador-icon-badge" style="background: var(--ubits-feedback-bg-success-subtle); border-color: var(--ubits-feedback-border-success);">
                                        <i class="far fa-check-circle" style="color: var(--ubits-feedback-fg-success-subtle);"></i>
                                    </div>
                                    <div class="indicador-content">
                                        <div class="indicador-number">45</div>
                                        <div class="indicador-meta">
                                            <span class="indicador-label">Finalizadas</span>
                                            <span class="indicador-percentage">32%</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Iniciadas -->
                                <div class="seguimiento-indicador-card">
                                    <div class="indicador-icon-badge" style="background: var(--ubits-feedback-bg-info-subtle); border-color: var(--ubits-feedback-border-info);">
                                        <i class="far fa-spinner" style="color: var(--ubits-feedback-fg-info-subtle);"></i>
                                    </div>
                                    <div class="indicador-content">
                                        <div class="indicador-number">28</div>
                                        <div class="indicador-meta">
                                            <span class="indicador-label">Iniciadas</span>
                                            <span class="indicador-percentage">20%</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Vencidas -->
                                <div class="seguimiento-indicador-card">
                                    <div class="indicador-icon-badge" style="background: var(--ubits-feedback-bg-error-subtle); border-color: var(--ubits-feedback-border-error);">
                                        <i class="far fa-exclamation-triangle" style="color: var(--ubits-feedback-fg-error-subtle);"></i>
                                    </div>
                                    <div class="indicador-content">
                                        <div class="indicador-number">12</div>
                                        <div class="indicador-meta">
                                            <span class="indicador-label">Vencidas</span>
                                            <span class="indicador-percentage">8%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Action bar (solo cuando hay selección) -->
                            <div class="widget-action-bar-seguimiento" id="seguimiento-action-bar">
                                <button type="button" class="ubits-button ubits-button--secondary ubits-button--sm" id="seguimiento-ver-seleccionados">
                                    <i class="far fa-eye"></i>
                                    <span>Ver seleccionados</span>
                                </button>
                                <div class="seguimiento-action-buttons">
                                    <button type="button" class="ubits-button ubits-button--secondary ubits-button--sm" id="seguimiento-reasignar" title="Reasignar">
                                        <i class="far fa-user-plus"></i>
                                        <span>Reasignar</span>
                                    </button>
                                    <button type="button" class="ubits-button ubits-button--secondary ubits-button--sm" id="seguimiento-cambiar-prioridad" title="Cambiar prioridad">
                                        <i class="far fa-sliders"></i>
                                        <span>Cambiar prioridad</span>
                                    </button>
                                    <button type="button" class="ubits-button ubits-button--secondary ubits-button--sm" id="seguimiento-cambiar-estado" title="Cambiar estado">
                                        <i class="far fa-rotate"></i>
                                        <span>Cambiar estado</span>
                                    </button>
                                    <button type="button" class="ubits-button ubits-button--secondary ubits-button--sm" id="seguimiento-cambiar-fecha-plan" title="Cambiar fecha de finalización" style="display: none;">
                                        <i class="far fa-calendar"></i>
                                        <span>Cambiar fecha</span>
                                    </button>
                                    <button type="button" class="ubits-button ubits-button--secondary ubits-button--sm" id="seguimiento-anadir-colaborador" title="Añadir colaborador al plan" style="display: none;">
                                        <i class="far fa-user-plus"></i>
                                        <span>Añadir colaborador</span>
                                    </button>
                                    <button type="button" class="ubits-button ubits-button--secondary ubits-button--sm" id="seguimiento-descargar" title="Descargar" aria-haspopup="true" aria-expanded="false">
                                        <i class="far fa-download"></i>
                                        <span>Descargar</span>
                                        <i class="far fa-chevron-down"></i>
                                    </button>
                                    <button type="button" class="ubits-button ubits-button--error-secondary ubits-button--sm" id="seguimiento-eliminar" title="Eliminar" aria-label="Eliminar">
                                        <i class="far fa-trash"></i>
                                        <span>Eliminar</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Alert experiencia desktop -->
                            <div class="seguimiento-alert-experiencia" id="seguimiento-alert-mobile" style="display: none;">
                                <div id="seguimiento-alert-container"></div>
                            </div>

                            <!-- Tabla (componente UBITS table) -->
                            <div class="widget-tabla-seguimiento">
                                <div class="ubits-table-wrapper ubits-table-wrapper--min-width">
                                <table class="ubits-table" id="seguimiento-table">
                                    <thead id="seguimiento-thead">
                                        <tr id="seguimiento-thead-row">
                                            <!-- Cabeceras generadas por JS según tab activo (Tareas / Planes) -->
                                        </tr>
                                    </thead>
                                    <tbody id="seguimiento-tbody">
                                        <!-- Filas generadas por JS -->
                                    </tbody>
                                </table>
                                </div>
                            </div>
                            
                            <!-- Empty State (oculto por defecto) -->
                            <div id="seguimiento-empty-state" style="display: none;"></div>
                            
                            <!-- Paginador -->
                            <div class="widget-paginador-seguimiento">
                                <div id="seguimiento-paginador"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="tab-bar-container"></div>
    <div id="floating-menu-container"></div>
    <div id="profile-menu-container"></div>

    <!-- Modales inyectados por componente oficial (modal.js getModalHtml) -->
    <div id="seguimiento-modals-container"></div>

    <!-- Modal columnas -->
    <div class="columns-menu-overlay" id="columns-menu-overlay" style="display: none;" aria-hidden="true"></div>
    <div class="columns-menu" id="columns-menu" style="display: none;" role="dialog" aria-label="Mostrar u ocultar columnas">
        <div class="columns-menu-list" id="columns-menu-list"></div>
    </div>

    <!-- Popover asignados (+N del profile list en Planes): solo visualización -->
    <div class="asignados-popover-overlay" id="asignados-popover-overlay" style="display: none;" aria-hidden="true"></div>
    <div class="asignados-popover" id="asignados-popover" style="display: none;" role="dialog" aria-label="Personas asignadas">
        <div class="asignados-popover-list" id="asignados-popover-list"></div>
    </div>

    <!-- Menú de período -->
    <div class="periodo-menu-overlay" id="periodo-menu-overlay" style="display: none;" aria-hidden="true"></div>
    <div class="periodo-menu" id="periodo-menu" style="display: none;" role="dialog" aria-label="Seleccionar período">
        <div class="periodo-menu-options">
            <button type="button" class="ubits-button ubits-button--tertiary ubits-button--sm periodo-menu-option" data-value="7">
                <span class="ubits-body-sm-regular">Últimos 7 días</span>
            </button>
            <button type="button" class="ubits-button ubits-button--tertiary ubits-button--sm periodo-menu-option" data-value="15">
                <span class="ubits-body-sm-regular">Últimos 15 días</span>
            </button>
            <button type="button" class="ubits-button ubits-button--tertiary ubits-button--sm periodo-menu-option" data-value="30">
                <span class="ubits-body-sm-regular">Últimos 30 días</span>
            </button>
            <button type="button" class="ubits-button ubits-button--tertiary ubits-button--sm periodo-menu-option" data-value="90">
                <span class="ubits-body-sm-regular">Últimos 3 meses</span>
            </button>
            <button type="button" class="ubits-button ubits-button--tertiary ubits-button--sm periodo-menu-option" data-value="180">
                <span class="ubits-body-sm-regular">Últimos 6 meses</span>
            </button>
            <button type="button" class="ubits-button ubits-button--tertiary ubits-button--sm periodo-menu-option" data-value="365">
                <span class="ubits-body-sm-regular">Último año</span>
            </button>
            <button type="button" class="ubits-button ubits-button--tertiary ubits-button--sm periodo-menu-option" data-value="personalizado" id="periodo-personalizado-btn">
                <span class="ubits-body-sm-regular">Personalizado</span>
            </button>
        </div>
    </div>

    <!-- Menú de ordenamiento por fecha -->
    <div class="sort-menu-overlay" id="sort-menu-overlay" style="display: none;"></div>
    <div class="sort-menu" id="sort-menu" style="display: none;" role="dialog" aria-label="Ordenar columna">
        <div class="sort-menu-options">
            <button type="button" class="ubits-button ubits-button--tertiary ubits-button--sm sort-menu-option" data-dir="desc">
                <i class="far fa-arrow-up"></i>
                <span class="ubits-body-sm-regular">Más reciente primero</span>
            </button>
            <button type="button" class="ubits-button ubits-button--tertiary ubits-button--sm sort-menu-option" data-dir="asc">
                <i class="far fa-arrow-down"></i>
                <span class="ubits-body-sm-regular">Más reciente al final</span>
            </button>
        </div>
        <div class="sort-menu-footer">
            <button type="button" class="ubits-button ubits-button--secondary ubits-button--sm" id="sort-menu-cancel">Cancelar</button>
            <button type="button" class="ubits-button ubits-button--primary ubits-button--sm" id="sort-menu-apply">Aceptar</button>
        </div>
    </div>

    <!-- Menú de filtro con autocomplete (para Nombre, Asignado, Plan, Creador) -->
    <div class="filter-menu-overlay" id="filter-menu-overlay" style="display: none;"></div>
    <div class="filter-menu" id="filter-menu" style="display: none;" role="dialog" aria-label="Filtrar columna">
        <div class="filter-menu-content">
            <div id="filter-autocomplete-container"></div>
        </div>
        <div class="filter-menu-footer">
            <button type="button" class="ubits-button ubits-button--secondary ubits-button--sm" id="filter-menu-cancel">Cancelar</button>
            <button type="button" class="ubits-button ubits-button--primary ubits-button--sm" id="filter-menu-apply">Aplicar</button>
        </div>
    </div>

    <!-- Menú de checkboxes (para Estado, Prioridad) -->
    <div class="checkbox-menu-overlay" id="checkbox-menu-overlay" style="display: none;"></div>
    <div class="checkbox-menu" id="checkbox-menu" style="display: none;" role="dialog" aria-label="Filtrar por opciones">
        <div class="checkbox-menu-options" id="checkbox-menu-options">
            <!-- Opciones se generan dinámicamente -->
        </div>
        <div class="checkbox-menu-footer">
            <button type="button" class="ubits-button ubits-button--secondary ubits-button--sm" id="checkbox-menu-cancel">Cancelar</button>
            <button type="button" class="ubits-button ubits-button--primary ubits-button--sm" id="checkbox-menu-apply">Aplicar</button>
        </div>
    </div>

    <!-- Menú flotante para cambiar prioridad -->
    <div class="priority-menu-overlay" id="priority-menu-overlay" style="display: none;"></div>
    <div class="priority-menu" id="priority-menu" style="display: none;" role="dialog" aria-label="Cambiar prioridad">
        <div class="priority-menu-options">
            <button type="button" class="ubits-button ubits-button--tertiary ubits-button--sm priority-menu-option" data-value="Alta">
                <i class="far fa-chevrons-up" style="color: var(--ubits-feedback-accent-error);"></i>
                <span class="ubits-body-sm-regular">Alta</span>
            </button>
            <button type="button" class="ubits-button ubits-button--tertiary ubits-button--sm priority-menu-option" data-value="Media">
                <i class="far fa-chevron-up" style="color: var(--ubits-fg-1-medium);"></i>
                <span class="ubits-body-sm-regular">Media</span>
            </button>
            <button type="button" class="ubits-button ubits-button--tertiary ubits-button--sm priority-menu-option" data-value="Baja">
                <i class="far fa-chevron-down" style="color: var(--ubits-feedback-accent-info);"></i>
                <span class="ubits-body-sm-regular">Baja</span>
            </button>
        </div>
    </div>

    <!-- Menú flotante para cambiar estado (texto, no status tag) -->
    <div class="status-menu-overlay" id="status-menu-overlay" style="display: none;"></div>
    <div class="status-menu" id="status-menu" style="display: none;" role="dialog" aria-label="Cambiar estado">
        <div class="status-menu-options">
            <button type="button" class="ubits-button ubits-button--tertiary ubits-button--sm status-menu-option" data-value="Iniciada">
                <span class="ubits-body-sm-regular">Iniciada</span>
            </button>
            <button type="button" class="ubits-button ubits-button--tertiary ubits-button--sm status-menu-option" data-value="Vencida">
                <span class="ubits-body-sm-regular">Vencida</span>
            </button>
            <button type="button" class="ubits-button ubits-button--tertiary ubits-button--sm status-menu-option" data-value="Finalizada">
                <span class="ubits-body-sm-regular">Finalizada</span>
            </button>
        </div>
    </div>

    <!-- Menú flotante para reasignar -->
    <div class="reasignar-menu-overlay" id="reasignar-menu-overlay" style="display: none;"></div>
    <div class="reasignar-menu" id="reasignar-menu" style="display: none;" role="dialog" aria-label="Reasignar">
        <div class="reasignar-menu-content">
            <div id="reasignar-autocomplete"></div>
        </div>
        <div class="reasignar-menu-footer">
            <button type="button" class="ubits-button ubits-button--secondary ubits-button--sm" id="reasignar-cancel">Cancelar</button>
            <button type="button" class="ubits-button ubits-button--primary ubits-button--sm" id="reasignar-apply">Aplicar</button>
        </div>
    </div>

    <!-- Menú desplegable Descargar (Excel / CSV) -->
    <div class="descargar-menu-overlay" id="descargar-menu-overlay" style="display: none;"></div>
    <div class="descargar-menu sort-menu" id="descargar-menu" style="display: none;" role="menu" aria-label="Opciones de descarga">
        <div class="sort-menu-options">
            <button type="button" class="ubits-button ubits-button--tertiary ubits-button--sm sort-menu-option" data-format="excel" role="menuitem">
                <i class="far fa-file-excel"></i>
                <span class="ubits-body-sm-regular">Descargar Excel</span>
            </button>
            <button type="button" class="ubits-button ubits-button--tertiary ubits-button--sm sort-menu-option" data-format="csv" role="menuitem">
                <i class="far fa-file-csv"></i>
                <span class="ubits-body-sm-regular">Descargar CSV</span>
            </button>
        </div>
    </div>

    <!-- Menú flotante añadir colaborador al plan -->
    <div class="anadir-colaborador-overlay" id="anadir-colaborador-overlay" style="display: none;"></div>
    <div class="anadir-colaborador-menu" id="anadir-colaborador-menu" style="display: none;" role="dialog" aria-label="Añadir colaborador al plan">
        <div class="anadir-colaborador-content">
            <div id="anadir-colaborador-autocomplete"></div>
        </div>
        <div class="anadir-colaborador-footer">
            <button type="button" class="ubits-button ubits-button--secondary ubits-button--sm" id="anadir-colaborador-cancel">Cancelar</button>
            <button type="button" class="ubits-button ubits-button--primary ubits-button--sm" id="anadir-colaborador-apply">Aplicar</button>
        </div>
    </div>

    <!-- Toast container -->
    <div id="ubits-toast-container"></div>

    <!-- Drawers Crear plan / Crear plantilla (compartidos con planes.js) -->
    <div id="create-template-drawer-overlay" class="template-drawer-overlay" style="display: none;">
        <div class="template-drawer-content" id="create-template-drawer"></div>
    </div>
    <div id="create-plan-drawer-overlay" class="template-drawer-overlay plan-drawer-overlay" style="display: none;">
        <div class="template-drawer-content plan-drawer-content" id="create-plan-drawer"></div>
    </div>

        <script src="../../components/tooltip.js"></script>
        <script src="../../components/sidebar.js"></script>
        <script src="../../components/sub-nav.js"></script>
        <script src="../../components/tab-bar.js"></script>
        <script src="../../components/floating-menu.js"></script>
        <script src="../../components/profile-menu.js"></script>
        <script src="../../components/header-product.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                if (typeof loadHeaderProduct !== 'function') return;
                loadHeaderProduct('header-product-seguimiento', {
                    variant: 'tabs-with-actions',
                    tabs: [
                        { id: 'tareas', label: 'Tareas' },
                        { id: 'planes', label: 'Planes' }
                    ],
                    activeTabId: 'tareas',
                    onTabChange: function() { /* switchToTab se encarga vía listener en #seguimiento-tabs */ },
                    primaryButton: {
                        text: 'Crear',
                        icon: 'fa-plus',
                        onClick: function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            if (typeof window.openCrearMenu === 'function') window.openCrearMenu(e.currentTarget);
                        }
                    }
                });
                var container = document.getElementById('header-product-seguimiento');
                if (container) {
                    var tabsEl = container.querySelector('.ubits-header-product__tabs');
                    if (tabsEl) tabsEl.id = 'seguimiento-tabs';
                    var primaryBtn = container.querySelector('.ubits-header-product__actions .ubits-button--primary');
                    if (primaryBtn) primaryBtn.id = 'seguimiento-crear-btn';
                }
            });
        </script>
        <script src="../../components/input.js"></script>
        <script src="../../components/calendar.js"></script>
    <script src="../../components/alert.js"></script>
    <script src="../../components/toast.js"></script>
    <script src="../../components/paginator.js"></script>
    <script src="../../components/empty-state.js"></script>
    <script src="../../script.js"></script>
    <script src="../../components/avatar.js"></script>
    <script src="../../components/modal.js"></script>
    <script src="../../components/drawer.js"></script>
    <script src="./tareas-base-unificada.js"></script>
    <script src="./planes.js"></script>
    <script src="./seguimiento.js"></script>
</body>
</html>
